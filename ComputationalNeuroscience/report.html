<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857143; overflow-x: hidden; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; tab-size: 4; background-position: inherit; background-repeat: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror-linenumber { }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; position: relative !important; background-position: inherit; background-repeat: inherit; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; background-position: 0px 0px; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print { 
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background-color: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-top-left-radius: 10px; border-top-right-radius: 10px; border-bottom-right-radius: 10px; border-bottom-left-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background-color: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; }
a.md-print-anchor { white-space: pre !important; border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; text-shadow: initial !important; background-position: 0px 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background-color: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print { 
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix { height: auto; margin-top: 16px; margin-bottom: 16px; }
.md-require-zoom-fix foreignObject { font-size: var(--mermaid-font-zoom); }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) { 
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) { 
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571429rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ''; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ''; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ''; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: '−'; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; white-space: nowrap; background-position: inherit; background-repeat: inherit; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background-image: inherit; background-size: inherit; background-attachment: inherit; background-origin: inherit; background-clip: inherit; background-color: inherit; background-position: inherit; background-repeat: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; border: none !important; background-position: 0px 0px !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background-position: 0px 0px; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background-color: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
  --mermaid-theme: night;
}

[lang='mermaid'] .label {
  color: #333;
}

/* CSS Document */

/** code highlight */

.cm-s-inner .cm-variable,
.cm-s-inner .cm-operator,
.cm-s-inner .cm-property {
    color: #b8bfc6;
}

.cm-s-inner .cm-keyword {
    color: #C88FD0;
}

.cm-s-inner .cm-tag {
    color: #7DF46A;
}

.cm-s-inner .cm-attribute {
    color: #7575E4;
}

.CodeMirror div.CodeMirror-cursor {
    border-left: 1px solid #b8bfc6;
    z-index: 3;
}

.cm-s-inner .cm-string {
    color: #D26B6B;
}

.cm-s-inner .cm-comment,
.cm-s-inner.cm-comment {
    color: #DA924A;
}

.cm-s-inner .cm-header,
.cm-s-inner .cm-def,
.cm-s-inner.cm-header,
.cm-s-inner.cm-def {
    color: #8d8df0;
}

.cm-s-inner .cm-quote,
.cm-s-inner.cm-quote {
    color: #57ac57;
}

.cm-s-inner .cm-hr {
    color: #d8d5d5;
}

.cm-s-inner .cm-link {
    color: #d3d3ef;
}

.cm-s-inner .cm-negative {
    color: #d95050;
}

.cm-s-inner .cm-positive {
    color: #50e650;
}

.cm-s-inner .cm-string-2 {
    color: #f50;
}

.cm-s-inner .cm-meta,
.cm-s-inner .cm-qualifier {
    color: #b7b3b3;
}

.cm-s-inner .cm-builtin {
    color: #f3b3f8;
}

.cm-s-inner .cm-bracket {
    color: #997;
}

.cm-s-inner .cm-atom,
.cm-s-inner.cm-atom {
    color: #84B6CB;
}

.cm-s-inner .cm-number {
    color: #64AB8F;
}

.cm-s-inner .cm-variable {
    color: #b8bfc6;
}

.cm-s-inner .cm-variable-2 {
    color: #9FBAD5;
}

.cm-s-inner .cm-variable-3 {
    color: #1cc685;
}

.CodeMirror-selectedtext,
.CodeMirror-selected {
    background: #4a89dc;
    color: #fff !important;
    text-shadow: none;
}

.CodeMirror-gutters {
    border-right: none;
}

/* CSS Document */

/** markdown source **/
.cm-s-typora-default .cm-header, 
.cm-s-typora-default .cm-property
{
    color: #cebcca;
}

.CodeMirror.cm-s-typora-default div.CodeMirror-cursor{
    border-left: 3px solid #b8bfc6;
}

.cm-s-typora-default .cm-comment {
    color: #9FB1FF;
}

.cm-s-typora-default .cm-string {
    color: #A7A7D9
}

.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number {
    color: #848695;
    font-style: italic;
}

.cm-s-typora-default .cm-link {
    color: #95B94B;
}

.cm-s-typora-default .CodeMirror-activeline-background {
    background: rgba(51, 51, 51, 0.72);
}

.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code {
	color: #8aa1e1;
}@import "";
@import "";
@import "";

:root {
    --bg-color:  #363B40;
    --side-bar-bg-color: #2E3033;
    --text-color: #b8bfc6;

    --select-text-bg-color:#4a89dc;

    --item-hover-bg-color: #0a0d16;
    --control-text-color: #b7b7b7;
    --control-text-hover-color: #eee;
    --window-border: 1px solid #555;

    --active-file-bg-color: rgb(34, 34, 34);
    --active-file-border-color: #8d8df0;

    --primary-color: #a3d5fe;

    --active-file-text-color: white;
    --item-hover-bg-color: #70717d;
    --item-hover-text-color: white;
    --primary-color: #6dc1e7;

    --rawblock-edit-panel-bd: #333;

    --search-select-bg-color: #428bca;
}

html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

html,
body {
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    background: #363B40;
    background: var(--bg-color);
    fill: currentColor;
    line-height: 1.625rem;
}

#write {
    max-width: 914px;
}


@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

html,
body,
button,
input,
select,
textarea,
div.code-tooltip-content {
    color: #b8bfc6;
    border-color: transparent;
}

div.code-tooltip,
.md-hover-tip .md-arrow:after {
    background: #333;
}

.native-window #md-notification {
    border: 1px solid #70717d;
}

.popover.bottom > .arrow:after {
    border-bottom-color: #333;
}

html,
body,
button,
input,
select,
textarea {
    font-family: "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
}

hr {
    height: 2px;
    border: 0;
    margin: 24px 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: "Lucida Grande", "Corbel", sans-serif;
    font-weight: normal;
    clear: both;
    -ms-word-wrap: break-word;
    word-wrap: break-word;
    margin: 0;
    padding: 0;
    color: #DEDEDE
}

h1 {
    font-size: 2.5rem;
    /* 36px */
    line-height: 2.75rem;
    /* 40px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1.5px;
}

h2 {
    font-size: 1.63rem;
    /* 24px */
    line-height: 1.875rem;
    /* 30px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h3 {
    font-size: 1.17rem;
    /* 18px */
    line-height: 1.5rem;
    /* 24px */
    margin-bottom: 1.5rem;
    /* 24px */
    letter-spacing: -1px;
    font-weight: bold;
}

h4 {
    font-size: 1.12rem;
    /* 16px */
    line-height: 1.375rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    color: white;
}

h5 {
    font-size: 0.97rem;
    /* 16px */
    line-height: 1.25rem;
    /* 22px */
    margin-bottom: 1.5rem;
    /* 24px */
    font-weight: bold;
}

h6 {
    font-size: 0.93rem;
    /* 16px */
    line-height: 1rem;
    /* 16px */
    margin-bottom: 0.75rem;
    color: white;
}

@media (min-width: 980px) {
    h3.md-focus:before,
    h4.md-focus:before,
    h5.md-focus:before,
    h6.md-focus:before {
        color: #ddd;
        border: 1px solid #ddd;
        border-radius: 3px;
        position: absolute;
        left: -1.642857143rem;
        top: .357142857rem;
        float: left;
        font-size: 9px;
        padding-left: 2px;
        padding-right: 2px;
        vertical-align: bottom;
        font-weight: normal;
        line-height: normal;
    }

    h3.md-focus:before {
        content: 'h3';
    }

    h4.md-focus:before {
        content: 'h4';
    }

    h5.md-focus:before {
        content: 'h5';
        top: 0px;
    }

    h6.md-focus:before {
        content: 'h6';
        top: 0px;
    }
}

a {
    text-decoration: none;
    outline: 0;
}

a:hover {
    outline: 0;
}

a:focus {
    outline: thin dotted;
}

sup.md-footnote {
    background-color: #555;
    color: #ddd;
}

p {
    -ms-word-wrap: break-word;
    word-wrap: break-word;
}

p,
ul,
dd,
ol,
hr,
address,
pre,
table,
iframe,
.wp-caption,
.wp-audio-shortcode,
.wp-video-shortcode {
    margin-top: 0;
    margin-bottom: 1.5rem;
    /* 24px */
}

audio:not([controls]) {
    display: none;
}

[hidden] {
    display: none;
}

::-moz-selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

*.in-text-selection,
::selection {
    background: #4a89dc;
    color: #fff;
    text-shadow: none;
}

ul,
ol {
    padding: 0 0 0 1.875rem;
    /* 30px */
}

ul {
    list-style: square;
}

ol {
    list-style: decimal;
}

ul ul,
ol ol,
ul ol,
ol ul {
    margin: 0;
}

b,
th,
dt,
strong {
    font-weight: bold;
}

i,
em,
dfn,
cite {
    font-style: italic;
}

blockquote {
    padding-left: 1.875rem;
    margin: 0 0 1.875rem 1.875rem;
    border-left: solid 2px #474d54;
    padding-left: 30px;
    margin-top: 35px;
}

pre,
code,
kbd,
tt,
var {
    font-size: 0.875em;
    font-family: Monaco, Consolas, "Andale Mono", "DejaVu Sans Mono", monospace;
}

code,
tt,
var {
    background: rgba(0, 0, 0, 0.05);
}

kbd {
    padding: 2px 4px;
    font-size: 90%;
    color: #fff;
    background-color: #333;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
}

pre.md-fences {
    padding: 10px 10px 10px 30px;
    margin-bottom: 20px;
    background: #333;
}

.CodeMirror-gutters {
    background: #333;
    border-right: 1px solid transparent;
}

.enable-diagrams pre.md-fences[lang="sequence"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="flow"] .code-tooltip,
.enable-diagrams pre.md-fences[lang="mermaid"] .code-tooltip {
    bottom: -2.2em;
    right: 4px;
}

code,
kbd,
tt,
var {
    padding: 2px 5px;
}

table {
    max-width: 100%;
    width: 100%;
    border-collapse: collapse;
    border-spacing: 0;
}

th,
td {
    padding: 5px 10px;
    vertical-align: top;
}

a {
    -webkit-transition: all .2s ease-in-out;
    transition: all .2s ease-in-out;
}

hr {
    background: #474d54;
    /* variable */
}

h1 {
    margin-top: 2em;
}

a {
    color: #e0e0e0;
    text-decoration: underline;
}

a:hover {
    color: #fff;
}

.md-inline-math script {
    color: #81b1db;
}

b,
th,
dt,
strong {
    color: #DEDEDE;
    /* variable */
}

mark {
    background: #D3D40E;
}

blockquote {
    color: #9DA2A6;
}

table a {
    color: #DEDEDE;
    /* variable */
}

th,
td {
    border: solid 1px #474d54;
    /* variable */
}

.task-list {
    padding-left: 0;
}

.md-task-list-item {
    padding-left: 1.25rem;
}

.md-task-list-item > input {
    top: auto;
}

.md-task-list-item > input:before {
    content: "";
    display: inline-block;
    width: 0.875rem;
    height: 0.875rem;
    vertical-align: middle;
    text-align: center;
    border: 1px solid #b8bfc6;
    background-color: #363B40;
    margin-top: -0.4rem;
}

.md-task-list-item > input:checked:before,
.md-task-list-item > input[checked]:before {
    content: '\221A';
    /*◘*/
    font-size: 0.625rem;
    line-height: 0.625rem;
    color: #DEDEDE;
}

/** quick open **/
.auto-suggest-container {
    border: 0px;
    background-color: #525C65;
}

#typora-quick-open {
    background-color: #525C65;
}

#typora-quick-open input{
    background-color: #525C65;
    border: 0;
    border-bottom: 1px solid grey;
}

.typora-quick-open-item {
    background-color: inherit;
    color: inherit;
}

.typora-quick-open-item.active,
.typora-quick-open-item:hover {
    background-color: #4D8BDB;
    color: white;
}

.typora-quick-open-item:hover {
    background-color: rgba(77, 139, 219, 0.8);
}

.typora-search-spinner > div {
  background-color: #fff;
}

#write pre.md-meta-block {
    border-bottom: 1px dashed #ccc;
    background: transparent;
    padding-bottom: 0.6em;
    line-height: 1.6em;
}

.btn,
.btn .btn-default {
    background: transparent;
    color: #b8bfc6;
}

.ty-table-edit {
    border-top: 1px solid gray;
    background-color: #363B40;
}

.popover-title {
    background: transparent;
}

.md-image>.md-meta {
    color: #BBBBBB;
    background: transparent;
}

.md-expand.md-image>.md-meta {
    color: #DDD;
}

#write>h3:before,
#write>h4:before,
#write>h5:before,
#write>h6:before {
    border: none;
    border-radius: 0px;
    color: #888;
    text-decoration: underline;
    left: -1.4rem;
    top: 0.2rem;
}

#write>h3.md-focus:before {
    top: 2px;
}

#write>h4.md-focus:before {
    top: 2px;
}

.md-toc-item {
    color: #A8C2DC;
}

#write div.md-toc-tooltip {
    background-color: #363B40;
}

.dropdown-menu .btn:hover,
.dropdown-menu .btn:focus,
.md-toc .btn:hover,
.md-toc .btn:focus {
    color: white;
    background: black;
}

#toc-dropmenu {
    background: rgba(50, 54, 59, 0.93);
    border: 1px solid rgba(253, 253, 253, 0.15);
}

#toc-dropmenu .divider {
    background-color: #9b9b9b;
}

.outline-expander:before {
    top: 2px;
}

#typora-sidebar {
    box-shadow: none;
    border-right: 1px dashed;
    border-right: none;
}

.sidebar-tabs {
    border-bottom:0;
}

#typora-sidebar:hover .outline-title-wrapper {
    border-left: 1px dashed;
}

.outline-title-wrapper .btn {
    color: inherit;
}

.outline-item:hover {
    border-color: #363B40;
    background-color: #363B40;
    color: white;
}

h1.md-focus .md-attr,
h2.md-focus .md-attr,
h3.md-focus .md-attr,
h4.md-focus .md-attr,
h5.md-focus .md-attr,
h6.md-focus .md-attr,
.md-header-span .md-attr {
    color: #8C8E92;
    display: inline;
}

.md-comment {
    color: #5a95e3;
    opacity: 1;
}

.md-inline-math svg {
    color: #b8bfc6;
}

#math-inline-preview .md-arrow:after {
    background: black;
}

.modal-content {
    background: var(--bg-color);
    border: 0;
}

.modal-title {
    font-size: 1.5em;
}

.modal-content input {
    background-color: rgba(26, 21, 21, 0.51);
    color: white;
}

.modal-content .input-group-addon {
    color: white;
}

.modal-backdrop {
    background-color: rgba(174, 174, 174, 0.7);
}

.modal-content .btn-primary {
    border-color: var(--primary-color);
}

.md-table-resize-popover {
    background-color: #333;
}

.form-inline .input-group .input-group-addon {
    color: white;
}

#md-searchpanel {
    border-bottom: 1px dashed grey;
}

/** UI for electron */

.context-menu,
#spell-check-panel,
#footer-word-count-info {
    background-color: #42464A;
}

.context-menu.dropdown-menu .divider,
.dropdown-menu .divider {
    background-color: #777777;
    opacity: 1;
}

footer {
    color: inherit;
}

@media (max-width: 1000px) {
    footer {
        border-top: none;
    }
    footer:hover {
        color: inherit;
    }
}

#file-info-file-path .file-info-field-value:hover {
    background-color: #555;
    color: #dedede;
}

.megamenu-content,
.megamenu-opened header {
    background: var(--bg-color);
}

.megamenu-menu-panel h2,
.megamenu-menu-panel h1,
.long-btn {
    color: inherit;
}

.megamenu-menu-panel input[type='text'] {
    background: inherit;
    border: 0;
    border-bottom: 1px solid;
}

#recent-file-panel-action-btn {
    background: inherit;
    border: 1px grey solid;
}

.megamenu-menu-panel .dropdown-menu > li > a {
    color: inherit;
    background-color: #2F353A;
    text-decoration: none;
}

.megamenu-menu-panel table td:nth-child(1) {
    color: inherit;
    font-weight: bold;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(1) {
    color: white;
}

.modal-footer .btn-default, 
.modal-footer .btn-primary,
.modal-footer .btn-default:not(:hover) {
    border: 1px solid;
    border-color: transparent;
}

.btn-primary {
    color: white;
}

.btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open > .dropdown-toggle.btn-default {
    color: white;
    border: 1px solid #ddd;
    background-color: inherit;
}

.modal-header {
    border-bottom: 0;
}

.modal-footer {
    border-top: 0;
}

#recent-file-panel tbody tr:nth-child(2n-1) {
    background-color: transparent !important;
}

.megamenu-menu-panel tbody tr:hover td:nth-child(2) {
    color: inherit;
}

.megamenu-menu-panel .btn {
    border: 1px solid #eee;
    background: transparent;
}

.mouse-hover .toolbar-icon.btn:hover,
#w-full.mouse-hover,
#w-pin.mouse-hover {
    background-color: inherit;
}

.typora-node::-webkit-scrollbar {
    width: 5px;
}

.typora-node::-webkit-scrollbar-thumb:vertical {
    background: rgba(250, 250, 250, 0.3);
}

.typora-node::-webkit-scrollbar-thumb:vertical:active {
    background: rgba(250, 250, 250, 0.5);
}

#w-unpin {
    background-color: #4182c4;
}

#top-titlebar, #top-titlebar * {
    color: var(--item-hover-text-color);
}

.typora-sourceview-on #toggle-sourceview-btn,
#footer-word-count:hover,
.ty-show-word-count #footer-word-count {
    background: #333333;
}

#toggle-sourceview-btn:hover {
    color: #eee;
    background: #333333;
}

/** focus mode */
.on-focus-mode .md-end-block:not(.md-focus):not(.md-focus-container) * {
    color: #686868 !important;
}

.on-focus-mode .md-end-block:not(.md-focus) img,
.on-focus-mode .md-task-list-item:not(.md-focus-container)>input {
    opacity: #686868 !important;
}

.on-focus-mode li[cid]:not(.md-focus-container){
    color: #686868;
}

.on-focus-mode .md-fences.md-focus .CodeMirror-code>*:not(.CodeMirror-activeline) *,
.on-focus-mode .CodeMirror.cm-s-inner:not(.CodeMirror-focused) * {
    color: #686868 !important;
}

.on-focus-mode .md-focus,
.on-focus-mode .md-focus-container {
    color: #fff;
}

.on-focus-mode #typora-source .CodeMirror-code>*:not(.CodeMirror-activeline) * {
    color: #686868 !important;
}


/*diagrams*/
#write .md-focus .md-diagram-panel {
    border: 1px solid #ddd;
    margin-left: -1px;
    width: calc(100% + 2px);
}

/*diagrams*/
#write .md-focus.md-fences-with-lineno .md-diagram-panel {
    margin-left: auto;
}

.md-diagram-panel-error {
    color: #f1908e;
}

.active-tab-files #info-panel-tab-file,
.active-tab-files #info-panel-tab-file:hover,
.active-tab-outline #info-panel-tab-outline,
.active-tab-outline #info-panel-tab-outline:hover {
    color: #eee;
}

.sidebar-footer-item:hover,
.footer-item:hover {
    background: inherit;
    color: white;
}

.ty-side-sort-btn.active,
.ty-side-sort-btn:hover,
.selected-folder-menu-item a:after {
    color: white;
}

#sidebar-files-menu {
    border:solid 1px;
    box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.79);
    background-color: var(--bg-color);
}

.file-list-item {
    border-bottom:none;
}

.file-list-item-summary {
    opacity: 1;
}

.file-list-item.active:first-child {
    border-top: none;
}

.file-node-background {
    height: 32px;
}

.file-library-node.active>.file-node-content,
.file-list-item.active {
    color: white;
    color: var(--active-file-text-color);
}

.file-library-node.active>.file-node-background{
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}
.file-list-item.active {
    background-color: rgb(34, 34, 34);
    background-color: var(--active-file-bg-color);
}

#ty-tooltip {
    background-color: black;
    color: #eee;
}

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: 0.3rem;
    -webkit-appearance: none;
}

.md-mathjax-midline {
    background-color: #57616b;
    border-bottom: none;
}

footer.ty-footer {
    border-color: #656565;
}

.ty-preferences .btn-default {
    background: transparent;
}
.ty-preferences .btn-default:hover {
    background: #57616b;
}

.ty-preferences select {
    border: 1px solid #989698;
    height: 21px;
}

.ty-preferences .nav-group-item.active,
.export-item.active,
.export-items-list-control,
.export-detail {
    background: var(--item-hover-bg-color);
}

.ty-preferences input[type="search"] {
    border-color: #333;
    background: #333;
    line-height: 22px;
    border-radius: 6px;
    color: white;
}

.ty-preferences input[type="search"]:focus {
    box-shadow: none;
}

[data-is-directory="true"] .file-node-content {
    margin-bottom: 0;
}

.file-node-title {
    line-height: 22px;
}

.html-for-mac .file-node-open-state, .html-for-mac .file-node-icon {
    line-height: 26px;
}

::-webkit-scrollbar-thumb {
    background: rgba(230, 230, 230, 0.30);
}

::-webkit-scrollbar-thumb:active {
    background: rgba(230, 230, 230, 0.50);
}

#typora-sidebar:hover div.sidebar-content-content::-webkit-scrollbar-thumb:horizontal {
    background: rgba(230, 230, 230, 0.30);
}

.nav-group-item:active {
    background-color: #474d54 !important;
}

.md-search-hit {
    background: rgba(199, 140, 60, 0.81);
    color: #eee;
}

.md-search-hit * {
    color: #eee;
}

#md-searchpanel input {
    color: white;
}

.modal-backdrop.in {
    opacity: 1;
    backdrop-filter: blur(1px);
}

.clear-btn-icon {
    top: 8px;
}


mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
  min-height: 1px;
  min-width: 1px;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > g > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
  stroke-width: 3;
}

g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}

.MathJax g[data-mml-node="xypic"] path {
  stroke-width: inherit;
}
mjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {
							stroke-width: 0;
						} :root {--mermaid-font-zoom:1em ;}  @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>report</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='neuronal-model-calibration-framework'><span>Neuronal Model Calibration Framework</span></h1><h2 id='introduction'><span>Introduction</span></h2><p><span>Hello,</span></p><p><span>We would like to introduce a neuronal model calibration framework, with the idea of being very user friendly for the beginners, but retaining high customization capabilities for the domain expert. </span></p><p><span>This post is organized as follows: </span></p><ul><li><a href='#1-overview'><span>Section 1</span></a><span> gives an overview of the issues addressed by this framework;</span></li><li><a href='#2-worked-example'><span>Section 2</span></a><span> goes through the current interface to showcase some capabilities (we tried to keep it as light and readable as possible);</span></li><li><a href='#3-possible-applications-from-literature'><span>Section 3</span></a><span> provides some literature example that fits naturally within our framework;</span></li><li><a href='#4-near-future-developments'><span>Section 4</span></a><span> concerns the developments we are going to make in the near future;</span></li><li><a href='#5-long-term-developments--needed-contributions'><span>Section 5</span></a><span> discusses the areas where we&#39;d need contribution from people more experienced than us;</span></li><li><a href='#6-example-calibration-results'><span>Section 6</span></a><span> illustrates some aspects of the current framework by looking at an user case with images.  </span></li></ul><p><span>We have developed a model calibration pipeline, where the model is currently limited to be a </span><a href='https://github.com/SciML/DifferentialEquations.jl'><span>DifferentiaEquations.jl</span></a><span>-compatible system, and though our intentions are very ambitious (see </span><a href='4. Near Future Developments'><span>section 4</span></a><span> and </span><a href='#5-long-term-developments--needed-contributions'><span>section 5</span></a><span>), the full support is now only guaranteed for Hodgkin-Huxley (HH) type models. In this context, the pipeline focuses on calibrating HH-type models w.r.t. voltage traces coming from electrophysiological recordings.</span></p><p><span>The pipeline assists the modeler in the tasks of electrophysiological data collection, model specification and model fitting. Many calibration features have been implemented (the main focus has been around the methodology first devised in </span><a href='https://www.frontiersin.org/articles/10.3389/neuro.01.1.1.001.2007/full'><span>Druckmann2007</span></a><span>, and then extended by numerous papers, e.g. Allen Brain Atlas&#39;s </span><a href=''><span>technical whitepapers</span></a><span>), and pretty much every main optimization technique that to our knowledge is available in Julia has been integrated (e.g. </span><a href='https://github.com/JuliaNLSolvers/Optim.jl'><span>Optim.jl</span></a><span>, </span><a href='https://github.com/TuringLang/Turing.jl'><span>Turing.jl</span></a><span>, </span><a href='https://github.com/wildart/Evolutionary.jl'><span>Evolutionary.jl</span></a><span>, </span><a href='https://github.com/jmejia8/Metaheuristics.jl'><span>Metaheuristics.jl</span></a><span>, </span><a href='https://github.com/robertfeldt/BlackBoxOptim.jl'><span>BlackBoxOptim.jl</span></a><span>, etc. ) and they are all accessible and fully customizable through a unified interface.</span></p><h2 id='1-overview'><span>1. Overview</span></h2><p><span>Before having a look at the currently developed interface, let me be more specific about the purpose and the setting of the pipeline. We will also briefly present the ideas behind and cite the main references.</span></p><p><span>Compartmental neuron models are inherently hard to calibrate w.r.t. electrophysiological recordings, because of:</span></p><ol start='' ><li><p><span>Their high degree of nonlinearity, which may induce:</span></p><ul><li><strong><span>simulation issues</span></strong><span>:  solver selection and optimization, computational time, etc. ;</span></li><li><strong><span>loss function complexity</span></strong><span> ;</span></li><li><strong><span>train set identification</span></strong><span>: difficulty in identifying a train set &quot;that covers the whole dynamical range&quot; of the neuron, which is equivalent to asking which is the best minimal set of stimuli to use as a train set, so that the calibrated model performs best on the test set, see </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002133'><span>Druckmann2011</span></a><span> . </span></li></ul></li><li><p><strong><span>Stochasticity of the underlying physical system</span></strong><span>: this implies that given a neuron, the same input (injected current) does not produce the same output (voltage trace) every time it is applied. This requires :</span></p><ul><li><strong><span>feature-based parameter estimation</span></strong><span>: since the voltage trace varies from sweep to sweep, its raw points cannot be used as a reliable way to measure a parameters set performance (and thus to calibrate a model). One must resort to the the extraction of features (defined by a domain expert) from that trace.</span></li><li><strong><span>calibration refinements</span></strong><span>: it could be necessary to perform successive calibration techniques to obtain a better fit.</span></li></ul></li></ol><p><span>These issues have been addressed in our work as follows:</span></p><ul><li><strong><span>simulation issues</span></strong><span>: we employed </span><a href='https://github.com/SciML/DifferentialEquations.jl'><span>DifferentialEquations.jl</span></a><span> efficient solving capabilities, and implemented an (almost) automated HH-type model conversion from the </span><em><span>gating variable rates formalism</span></em><span> (GVRF) to the </span><em><span>boltzmann terms formalism</span></em><span> (BTF), which makes out-of-dynamic-range derivatives more controllable during calibration (</span><a href='https://ieeexplore.ieee.org/document/5491188'><span>Chen2010</span></a><span> and </span><a href='https://link.springer.com/article/10.1007%2Fs00422-011-0459-1'><span>Thot2011</span></a><span>). This is achieved thanks to a set of structs representing membrane </span><code>Current</code><span>s and </span><code>Gating_Variable</code><span>s that are aware of the formalism they are written in ;</span></li><li><strong><span>train set identification</span></strong><span>: the pipeline allows for simultaneous multi-sweep calibration, where sweep grouping by stimulus type and amplitude is supported (and in some cases automatized), and so is the extraction of electrophysiological features means and standard deviations from such groups. These groups of sweeps are represented using a struct </span><code>Type_Amplitude</code><span>, which contains all sweeps obtained injecting the same stimulus (defined by a &quot;type&quot; which can be a </span><em><span>ramp</span></em><span>, a </span><em><span>square</span></em><span> and so on, and an &quot;amplitude&quot; expressed in pA). Thus the ideas behind </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002133'><span>Druckmann2011</span></a><span> can be easily tested, so as every other experiment ;</span></li><li><strong><span>feature-based parameter estimation</span></strong><span>: the pipeline integrates electrophysiological features through a </span><code>Feature</code><span> struct, whose use is highlighted below. </span><code>Feature</code><span>s also support </span><em><span>combination</span></em><span>, as in </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002107'><span>Hay2011</span></a><span>, even though more general </span><code>combination</code><span>s have been made possible. </span><code>Feature</code><span>s values extracted from the data and from the simulated model are regularly compared during calibration, and the comparison is done through a loss function: this (together with many other details) can be independently specified for each </span><code>Feature</code><span>, and many common features have been already implemented. If the user wishes to adopt a custom feature, much support for </span><a href='https://allensdk.readthedocs.io/en/latest/'><span>Allen SDK</span></a><span> and </span><a href='https://efel.readthedocs.io/en/latest/'><span>eFel</span></a><span> is already there ;</span></li><li><strong><span>complex loss functions</span></strong><span>: this probably determined the poor performance of derivative-based optimization algorithm such as the BFGS from </span><a href='https://github.com/JuliaNLSolvers/Optim.jl'><span>Optim.jl</span></a><span> (even though it&#39;s fair to say that we have little experience about hyperparameter tuning of optimization algorithms, see </span><a href='#5-long-term-developments--needed-contributions'><span>section 5</span></a><span>), in favor of evolutionary algorithms, especially the ones supporting multi-objective optimization, that could be found in </span><a href='https://github.com/jmejia8/Metaheuristics.jl'><span>Metaheuristics.jl</span></a><span> and </span><a href='https://github.com/robertfeldt/BlackBoxOptim.jl'><span>BlackBoxOptim.jl</span></a><span> ;</span></li><li><strong><span>calibration refinements</span></strong><span> : this pipeline has been built using a modeling package that we hope to publish in the near future. As such, it supports multi-step calibration, so that multiple calibration techniques may be stacked together, each one improving on the results of the previous one.</span></li></ul><h2 id='2-worked-example'><span>2. Worked Example</span></h2><p><span>Being our work integrated with </span><a href='https://allensdk.readthedocs.io/en/latest/'><span>Allen SDK</span></a><span>, let us now showcase how one may calibrate an HH-type model taken from </span><a href='https://link.springer.com/article/10.1007%2Fs00422-008-0263-8'><span>Pospischil2008</span></a><span> w.r.t. two </span><code>Type_Amplitude</code><span>s measured from cell number 488697163 in the </span><a href='https://celltypes.brain-map.org/'><span>Allen Cell Types</span></a><span> mouse database, one corresponding to a square pulse of amplitude 110pA, and the other to a ramp pulse of amplitude 800pA.  </span></p><p><span>First of all we&#39;re going to import all the relevant custom modules:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">using</span> <span class="cm-variable">ModelingFramework</span> <span class="cm-comment"># This is a meta-package we developed that eases the production of domain-specific modeling packages like this one.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">using</span> <span class="cm-variable">Computational_Neuroscience</span> <span class="cm-comment"># This module exports all computational neuroscience specific functionalities, such as the Sweep, Feature and Type_Amplitude structs and loss functions.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">include</span>(<span class="cm-builtin">joinpath</span>(<span class="cm-meta">@__DIR__</span>,<span class="cm-string">"src/Models/HH__Na_Kd_M_L_mf.jl"</span> )) &nbsp;<span class="cm-comment"># Load the model (see below).</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">include</span>(<span class="cm-builtin">joinpath</span>(<span class="cm-meta">@__DIR__</span>,<span class="cm-string">"src/Models/Neuron_Parameters.jl"</span> )) <span class="cm-comment"># A script containing all default parameter sets obtained from the literature for each HH-type model defined in Neuron_Models. Besides, it also contains all the membrane `Current`s derived from literature.</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 312px;"></div><div class="CodeMirror-gutters" style="display: none; height: 312px;"></div></div></div></pre><p><span>As stated in the last comment, the script </span><code>Neuron_Parameters.jl</code><span> contains all </span><code>Current</code><span>s. They are responsible for the </span><em><span>formalism switching</span></em><span> as described in the </span><strong><span>simulation issues</span></strong><span>. But how is a </span><code>Current</code><span> defined, and how does it allow for formalism switching ?</span><br><span>We will explore it in the next paragraphs.</span></p><h3 id='21-membrane-currents-definition'><span>2.1 Membrane currents definition</span></h3><p><span>First we should remember that a  gating variable </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 572 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-13-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-13-TEX-I-1D465"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">x</script><span> is written in the GVRF if it satisfies a differential equation of the form:</span></p><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n60" cid="n60" mdtype="math_block" data-math-tag-before="0" data-math-tag-after="1" data-math-labels="[]"><div class="md-rawblock-container md-math-container" tabindex="-1"><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 40.125ex; position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="4.676ex" role="img" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -1.773ex; min-width: 40.125ex;"><defs><path id="MJX-1-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-1-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-1-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path id="MJX-1-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-1-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-1-TEX-I-1D6FD" d="M29 -194Q23 -188 23 -186Q23 -183 102 134T186 465Q208 533 243 584T309 658Q365 705 429 705H431Q493 705 533 667T573 570Q573 465 469 396L482 383Q533 332 533 252Q533 139 448 65T257 -10Q227 -10 203 -2T165 17T143 40T131 59T126 65L62 -188Q60 -194 42 -194H29ZM353 431Q392 431 427 419L432 422Q436 426 439 429T449 439T461 453T472 471T484 495T493 524T501 560Q503 569 503 593Q503 611 502 616Q487 667 426 667Q384 667 347 643T286 582T247 514T224 455Q219 439 186 308T152 168Q151 163 151 147Q151 99 173 68Q204 26 260 26Q302 26 349 51T425 137Q441 171 449 214T457 279Q457 337 422 372Q380 358 347 358H337Q258 358 258 389Q258 396 261 403Q275 431 353 431Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1283.5)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1283.5) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="6789.7 -1283.5 1 2067"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-86.5)"><g data-mml-node="mtd"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(520,0)"><use data-c="1D465" xlink:href="#MJX-1-TEX-I-1D465"></use></g></g><g data-mml-node="mrow" transform="translate(325.5,-686)"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-1-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(520,0)"><use data-c="1D461" xlink:href="#MJX-1-TEX-I-1D461"></use></g></g><rect width="1292" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1532,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1921,0)"><use data-c="1D449" xlink:href="#MJX-1-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(2690,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(3356.8,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(4412.6,0)"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="mo" transform="translate(5052.6,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(5441.6,0)"><use data-c="1D449" xlink:href="#MJX-1-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(6210.6,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(6599.6,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(6988.6,0)"><use data-c="31" xlink:href="#MJX-1-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(7710.8,0)"><use data-c="2212" xlink:href="#MJX-1-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(8711,0)"><use data-c="1D465" xlink:href="#MJX-1-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(9283,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(9894.2,0)"><use data-c="2212" xlink:href="#MJX-1-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(10894.4,0)"><use data-c="1D6FD" xlink:href="#MJX-1-TEX-I-1D6FD"></use></g><g data-mml-node="mo" transform="translate(11460.4,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(11849.4,0)"><use data-c="1D449" xlink:href="#MJX-1-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(12618.4,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mi" transform="translate(13007.4,0)"><use data-c="1D465" xlink:href="#MJX-1-TEX-I-1D465"></use></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1283.5 1 2067"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:1" transform="translate(0,663.5)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use><use data-c="31" xlink:href="#MJX-1-TEX-N-31" transform="translate(389,0)"></use><use data-c="29" xlink:href="#MJX-1-TEX-N-29" transform="translate(889,0)"></use></g></g></g></g></svg></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd><mtext>(1)</mtext></mtd><mtd><mfrac><mrow><mi>d</mi><mi>x</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>α</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>x</mi><mo stretchy="false">)</mo><mo>−</mo><mi>β</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mi>x</mi></mtd></mlabeledtr></mtable></math></mjx-assistive-mml></mjx-container></div></div><p><span>In a specific module </span><code>Currents.jl</code><span>, we represented the </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.448ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 640 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-7-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-7-TEX-I-1D6FC"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">\alpha</script><span>s and the </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.281ex" height="2.034ex" role="img" focusable="false" viewBox="0 -705 566 899" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.439ex;"><defs><path id="MJX-8-TEX-I-1D6FD" d="M29 -194Q23 -188 23 -186Q23 -183 102 134T186 465Q208 533 243 584T309 658Q365 705 429 705H431Q493 705 533 667T573 570Q573 465 469 396L482 383Q533 332 533 252Q533 139 448 65T257 -10Q227 -10 203 -2T165 17T143 40T131 59T126 65L62 -188Q60 -194 42 -194H29ZM353 431Q392 431 427 419L432 422Q436 426 439 429T449 439T461 453T472 471T484 495T493 524T501 560Q503 569 503 593Q503 611 502 616Q487 667 426 667Q384 667 347 643T286 582T247 514T224 455Q219 439 186 308T152 168Q151 163 151 147Q151 99 173 68Q204 26 260 26Q302 26 349 51T425 137Q441 171 449 214T457 279Q457 337 422 372Q380 358 347 358H337Q258 358 258 389Q258 396 261 403Q275 431 353 431Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D6FD" xlink:href="#MJX-8-TEX-I-1D6FD"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">\beta</script><span>s as </span><code>Gating_Variable_Rate</code><span>s:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Currents.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># struct that represents a gating variable rate</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">Gating_Variable_Rate</span>{<span class="cm-variable">F</span><span class="cm-operator">&lt;</span><span class="cm-builtin">:Function</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">evaluation</span><span class="cm-builtin">::F</span> <span class="cm-comment"># the actual formula for the α or the β. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">symbols</span><span class="cm-builtin">::Vector{Symbol}</span> <span class="cm-comment"># symbols representing the parameters contained in the `evaluation` field</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 182px;"></div><div class="CodeMirror-gutters" style="display: none; height: 182px;"></div></div></div></pre><p><span>A gating variable </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 572 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-13-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-13-TEX-I-1D465"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">x</script><span> is instead written in the BTF if it satisfies:</span></p><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n64" cid="n64" mdtype="math_block" data-math-tag-before="1" data-math-tag-after="2" data-math-labels="[]"><div class="md-rawblock-container md-math-container" tabindex="-1"><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 34.523ex; position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="5.475ex" role="img" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.172ex; min-width: 34.523ex;"><defs><path id="MJX-2-TEX-I-1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-2-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-2-TEX-I-1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path id="MJX-2-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-2-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-2-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-2-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-2-TEX-N-221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path><path id="MJX-2-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-2-TEX-I-1D70F" d="M39 284Q18 284 18 294Q18 301 45 338T99 398Q134 425 164 429Q170 431 332 431Q492 431 497 429Q517 424 517 402Q517 388 508 376T485 360Q479 358 389 358T299 356Q298 355 283 274T251 109T233 20Q228 5 215 -4T186 -13Q153 -13 153 20V30L203 192Q214 228 227 272T248 336L254 357Q254 358 208 358Q206 358 197 358T183 359Q105 359 61 295Q56 287 53 286T39 284Z"></path><path id="MJX-2-TEX-N-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1460)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1460) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="5551.6 -1460 1 2420"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr"><g data-mml-node="mtd"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-2-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(520,0)"><use data-c="1D465" xlink:href="#MJX-2-TEX-I-1D465"></use></g></g><g data-mml-node="mrow" transform="translate(325.5,-686)"><g data-mml-node="mi"><use data-c="1D451" xlink:href="#MJX-2-TEX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(520,0)"><use data-c="1D461" xlink:href="#MJX-2-TEX-I-1D461"></use></g></g><rect width="1292" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(1532,0)"><use data-c="28" xlink:href="#MJX-2-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1921,0)"><use data-c="1D449" xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(2690,0)"><use data-c="29" xlink:href="#MJX-2-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(3356.8,0)"><use data-c="3D" xlink:href="#MJX-2-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(4412.6,0)"><g data-mml-node="mrow" transform="translate(220,710)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-2-TEX-I-1D465"></use></g><g data-mml-node="TeXAtom" transform="translate(605,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="221E" xlink:href="#MJX-2-TEX-N-221E"></use></g></g></g><g data-mml-node="mo" transform="translate(1362.1,0)"><use data-c="28" xlink:href="#MJX-2-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1751.1,0)"><use data-c="1D449" xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(2520.1,0)"><use data-c="29" xlink:href="#MJX-2-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(3131.3,0)"><use data-c="2212" xlink:href="#MJX-2-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(4131.6,0)"><use data-c="1D465" xlink:href="#MJX-2-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(4703.6,0)"><use data-c="28" xlink:href="#MJX-2-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(5092.6,0)"><use data-c="1D449" xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(5861.6,0)"><use data-c="29" xlink:href="#MJX-2-TEX-N-29"></use></g></g><g data-mml-node="mrow" transform="translate(2109.5,-710)"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D70F" xlink:href="#MJX-2-TEX-I-1D70F"></use></g><g data-mml-node="mi" transform="translate(470,-150) scale(0.707)"><use data-c="1D465" xlink:href="#MJX-2-TEX-I-1D465"></use></g></g><g data-mml-node="mo" transform="translate(924.5,0)"><use data-c="28" xlink:href="#MJX-2-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1313.5,0)"><use data-c="1D449" xlink:href="#MJX-2-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(2082.5,0)"><use data-c="29" xlink:href="#MJX-2-TEX-N-29"></use></g></g><rect width="6450.6" height="60" x="120" y="220"></rect></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1460 1 2420"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:2"><g data-mml-node="mtext"><use data-c="28" xlink:href="#MJX-2-TEX-N-28"></use><use data-c="32" xlink:href="#MJX-2-TEX-N-32" transform="translate(389,0)"></use><use data-c="29" xlink:href="#MJX-2-TEX-N-29" transform="translate(889,0)"></use></g></g></g></svg></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd><mtext>(2)</mtext></mtd><mtd><mfrac><mrow><mi>d</mi><mi>x</mi></mrow><mrow><mi>d</mi><mi>t</mi></mrow></mfrac><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">∞</mi></mrow></msub><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>−</mo><mi>x</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><mrow><msub><mi>τ</mi><mi>x</mi></msub><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow></mfrac></mtd></mlabeledtr></mtable></math></mjx-assistive-mml></mjx-container></div></div><p><span>So we represented the </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.082ex" height="1.357ex" role="img" focusable="false" viewBox="0 -442 1362.1 599.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-10-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-10-TEX-N-221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-10-TEX-I-1D465"></use></g><g data-mml-node="TeXAtom" transform="translate(605,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="221E" xlink:href="#MJX-10-TEX-N-221E"></use></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>x</mi><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">∞</mi></mrow></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">x_{\infin}</script><span>s and the </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.092ex" height="1.332ex" role="img" focusable="false" viewBox="0 -431 924.5 588.8" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.357ex;"><defs><path id="MJX-11-TEX-I-1D70F" d="M39 284Q18 284 18 294Q18 301 45 338T99 398Q134 425 164 429Q170 431 332 431Q492 431 497 429Q517 424 517 402Q517 388 508 376T485 360Q479 358 389 358T299 356Q298 355 283 274T251 109T233 20Q228 5 215 -4T186 -13Q153 -13 153 20V30L203 192Q214 228 227 272T248 336L254 357Q254 358 208 358Q206 358 197 358T183 359Q105 359 61 295Q56 287 53 286T39 284Z"></path><path id="MJX-11-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D70F" xlink:href="#MJX-11-TEX-I-1D70F"></use></g><g data-mml-node="mi" transform="translate(470,-150) scale(0.707)"><use data-c="1D465" xlink:href="#MJX-11-TEX-I-1D465"></use></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>τ</mi><mi>x</mi></msub></math></mjx-assistive-mml></mjx-container><script type="math/tex">\tau_x</script><span>s as </span><code>Gating_Variable_Boltzmann_Term</code><span>s:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Currents.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># struct that represents a gating variable boltzmann term</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">Gating_Variable_Boltzmann_Term</span>{<span class="cm-variable">F</span><span class="cm-operator">&lt;</span><span class="cm-builtin">:Function</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">evaluation</span><span class="cm-builtin">::F</span> <span class="cm-comment"># the actual formula for the x_∞ or the τₓ. </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-variable">symbols</span> <span class="cm-comment"># symbols representing the parameters contained in the `evaluation` field</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 182px;"></div><div class="CodeMirror-gutters" style="display: none; height: 182px;"></div></div></div></pre><p><span>Since simulation is more efficient in the BTF (</span><a href='https://link.springer.com/article/10.1007%2Fs00422-011-0459-1'><span>Thot2011</span></a><span>), we opted to represent gating variables always in that setting:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Currents.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># struct that represents a gating variable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">Gating_Variable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">symbol</span> <span class="cm-comment"># a symbol identifing this gating variable, e.g. :m</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x₀</span><span class="cm-builtin">::Gating_Variable_Boltzmann_Term</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">τ</span><span class="cm-builtin">::Gating_Variable_Boltzmann_Term</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment"># other fields that aren't relevant to our purposes</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="display: none; height: 234px;"></div></div></div></pre><p><span>Anyway, the user is free to use a constructor that accepts </span><code>Gating_Variable_Rate</code><span>s, that internally calculates the </span><code>Gating_Variable_Boltzmann_Term</code><span>s and outputs the </span><code>Gating_Variable</code><span> in BTF:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Currents.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># You may skip the implementation details, here reported just for completeness.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">Gating_Variable</span>(<span class="cm-variable">symbol</span><span class="cm-builtin">::Symbol</span>; <span class="cm-variable">α</span><span class="cm-builtin">::Gating_Variable_Rate</span>, <span class="cm-variable">β</span><span class="cm-builtin">::Gating_Variable_Rate</span>) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">symbols</span><span class="cm-builtin">::Vector{Symbol}</span> <span class="cm-operator">=</span> <span class="cm-builtin">vcat</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>, &nbsp;<span class="cm-variable">β</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x₀_evaluation</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">V</span><span class="cm-builtin">::Float64</span>,<span class="cm-variable">p</span><span class="cm-builtin">::Vector{Float64}</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-builtin">evaluation</span>(<span class="cm-variable">V</span>, <span class="cm-variable">p</span>[<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-builtin">length</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>)])<span class="cm-operator">/</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-builtin">evaluation</span>(<span class="cm-variable">V</span>, <span class="cm-variable">p</span>[<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-builtin">length</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>)]) <span class="cm-operator">+</span> <span class="cm-variable">β</span><span class="cm-operator">.</span><span class="cm-builtin">evaluation</span>(<span class="cm-variable">V</span>, <span class="cm-variable">p</span>[<span class="cm-builtin">length</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>)<span class="cm-operator">+</span><span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-keyword">end</span>]))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x₀</span><span class="cm-builtin">::Gating_Variable_Boltzmann_Term</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable_Boltzmann_Term</span>(<span class="cm-variable">symbols</span>,<span class="cm-variable">x₀_evaluation</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">τ_evaluation</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">V</span><span class="cm-builtin">::Float64</span>,<span class="cm-variable">p</span><span class="cm-builtin">::Vector{Float64}</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-number">1</span><span class="cm-operator">/</span>( <span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-builtin">evaluation</span>(<span class="cm-variable">V</span>,<span class="cm-variable">p</span>[<span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-builtin">length</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>)]) <span class="cm-operator">+</span> <span class="cm-variable">β</span><span class="cm-operator">.</span><span class="cm-builtin">evaluation</span>(<span class="cm-variable">V</span>,<span class="cm-variable">p</span>[<span class="cm-builtin">length</span>(<span class="cm-variable">α</span><span class="cm-operator">.</span><span class="cm-variable">symbols</span>)<span class="cm-operator">+</span><span class="cm-number">1</span><span class="cm-operator">:</span><span class="cm-keyword">end</span>]) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">τ</span><span class="cm-builtin">::Gating_Variable_Boltzmann_Term</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable_Boltzmann_Term</span>(<span class="cm-variable">symbols</span>,<span class="cm-variable">τ_evaluation</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-builtin">Gating_Variable</span>(<span class="cm-variable">symbol</span> <span class="cm-operator">=</span> <span class="cm-variable">symbol</span>, &nbsp;<span class="cm-variable">x₀</span> <span class="cm-operator">=</span> <span class="cm-variable">x₀</span>, <span class="cm-variable">τ</span> <span class="cm-operator">=</span> <span class="cm-variable">τ</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 546px;"></div><div class="CodeMirror-gutters" style="display: none; height: 546px;"></div></div></div></pre><p><span>The link between the two formalisms is given by:</span></p><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n72" cid="n72" mdtype="math_block" data-math-tag-before="2" data-math-tag-after="3" data-math-labels="[]"><div class="md-rawblock-container md-math-container" tabindex="-1"><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 32.491ex; position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="5.475ex" role="img" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.172ex; min-width: 32.491ex;"><defs><path id="MJX-3-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-3-TEX-N-221E" d="M55 217Q55 305 111 373T254 442Q342 442 419 381Q457 350 493 303L507 284L514 294Q618 442 747 442Q833 442 888 374T944 214Q944 128 889 59T743 -11Q657 -11 580 50Q542 81 506 128L492 147L485 137Q381 -11 252 -11Q166 -11 111 57T55 217ZM907 217Q907 285 869 341T761 397Q740 397 720 392T682 378T648 359T619 335T594 310T574 285T559 263T548 246L543 238L574 198Q605 158 622 138T664 94T714 61T765 51Q827 51 867 100T907 217ZM92 214Q92 145 131 89T239 33Q357 33 456 193L425 233Q364 312 334 337Q285 380 233 380Q171 380 132 331T92 214Z"></path><path id="MJX-3-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-3-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-3-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-3-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-3-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path id="MJX-3-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-3-TEX-I-1D6FD" d="M29 -194Q23 -188 23 -186Q23 -183 102 134T186 465Q208 533 243 584T309 658Q365 705 429 705H431Q493 705 533 667T573 570Q573 465 469 396L482 383Q533 332 533 252Q533 139 448 65T257 -10Q227 -10 203 -2T165 17T143 40T131 59T126 65L62 -188Q60 -194 42 -194H29ZM353 431Q392 431 427 419L432 422Q436 426 439 429T449 439T461 453T472 471T484 495T493 524T501 560Q503 569 503 593Q503 611 502 616Q487 667 426 667Q384 667 347 643T286 582T247 514T224 455Q219 439 186 308T152 168Q151 163 151 147Q151 99 173 68Q204 26 260 26Q302 26 349 51T425 137Q441 171 449 214T457 279Q457 337 422 372Q380 358 347 358H337Q258 358 258 389Q258 396 261 403Q275 431 353 431Z"></path><path id="MJX-3-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1460)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1460) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="5102.6 -1460 1 2420"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-3-TEX-I-1D465"></use></g><g data-mml-node="TeXAtom" transform="translate(605,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><use data-c="221E" xlink:href="#MJX-3-TEX-N-221E"></use></g></g></g><g data-mml-node="mo" transform="translate(1362.1,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1751.1,0)"><use data-c="1D449" xlink:href="#MJX-3-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(2520.1,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(3186.9,0)"><use data-c="3D" xlink:href="#MJX-3-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(4242.7,0)"><g data-mml-node="mrow" transform="translate(1887.7,710)"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-3-TEX-I-1D6FC"></use></g><g data-mml-node="mo" transform="translate(640,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1029,0)"><use data-c="1D449" xlink:href="#MJX-3-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(1798,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-3-TEX-I-1D6FC"></use></g><g data-mml-node="mo" transform="translate(640,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1029,0)"><use data-c="1D449" xlink:href="#MJX-3-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(1798,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(2409.2,0)"><use data-c="2B" xlink:href="#MJX-3-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(3409.4,0)"><use data-c="1D6FD" xlink:href="#MJX-3-TEX-I-1D6FD"></use></g><g data-mml-node="mo" transform="translate(3975.4,0)"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(4364.4,0)"><use data-c="1D449" xlink:href="#MJX-3-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(5133.4,0)"><use data-c="29" xlink:href="#MJX-3-TEX-N-29"></use></g></g><rect width="5722.4" height="60" x="120" y="220"></rect></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1460 1 2420"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:3"><g data-mml-node="mtext"><use data-c="28" xlink:href="#MJX-3-TEX-N-28"></use><use data-c="33" xlink:href="#MJX-3-TEX-N-33" transform="translate(389,0)"></use><use data-c="29" xlink:href="#MJX-3-TEX-N-29" transform="translate(889,0)"></use></g></g></g></svg></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd><mtext>(3)</mtext></mtd><mtd><msub><mi>x</mi><mrow data-mjx-texclass="ORD"><mi mathvariant="normal">∞</mi></mrow></msub><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>α</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow><mrow><mi>α</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>+</mo><mi>β</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow></mfrac></mtd></mlabeledtr></mtable></math></mjx-assistive-mml></mjx-container></div></div><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n73" cid="n73" mdtype="math_block" data-math-tag-before="3" data-math-tag-after="4" data-math-labels="[]"><div class="md-rawblock-container md-math-container" tabindex="-1"><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 31.501ex; position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="5.208ex" role="img" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -2.038ex; min-width: 31.501ex;"><defs><path id="MJX-4-TEX-I-1D70F" d="M39 284Q18 284 18 294Q18 301 45 338T99 398Q134 425 164 429Q170 431 332 431Q492 431 497 429Q517 424 517 402Q517 388 508 376T485 360Q479 358 389 358T299 356Q298 355 283 274T251 109T233 20Q228 5 215 -4T186 -13Q153 -13 153 20V30L203 192Q214 228 227 272T248 336L254 357Q254 358 208 358Q206 358 197 358T183 359Q105 359 61 295Q56 287 53 286T39 284Z"></path><path id="MJX-4-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-4-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-4-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-4-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-4-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-4-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-4-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path id="MJX-4-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-4-TEX-I-1D6FD" d="M29 -194Q23 -188 23 -186Q23 -183 102 134T186 465Q208 533 243 584T309 658Q365 705 429 705H431Q493 705 533 667T573 570Q573 465 469 396L482 383Q533 332 533 252Q533 139 448 65T257 -10Q227 -10 203 -2T165 17T143 40T131 59T126 65L62 -188Q60 -194 42 -194H29ZM353 431Q392 431 427 419L432 422Q436 426 439 429T449 439T461 453T472 471T484 495T493 524T501 560Q503 569 503 593Q503 611 502 616Q487 667 426 667Q384 667 347 643T286 582T247 514T224 455Q219 439 186 308T152 168Q151 163 151 147Q151 99 173 68Q204 26 260 26Q302 26 349 51T425 137Q441 171 449 214T457 279Q457 337 422 372Q380 358 347 358H337Q258 358 258 389Q258 396 261 403Q275 431 353 431Z"></path><path id="MJX-4-TEX-N-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1401)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1401) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="4883.7 -1401 1 2302"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,59)"><g data-mml-node="mtd"><g data-mml-node="msub"><g data-mml-node="mi"><use data-c="1D70F" xlink:href="#MJX-4-TEX-I-1D70F"></use></g><g data-mml-node="mi" transform="translate(470,-150) scale(0.707)"><use data-c="1D465" xlink:href="#MJX-4-TEX-I-1D465"></use></g></g><g data-mml-node="mo" transform="translate(924.5,0)"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1313.5,0)"><use data-c="1D449" xlink:href="#MJX-4-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(2082.5,0)"><use data-c="29" xlink:href="#MJX-4-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(2749.2,0)"><use data-c="3D" xlink:href="#MJX-4-TEX-N-3D"></use></g><g data-mml-node="mfrac" transform="translate(3805,0)"><g data-mml-node="mn" transform="translate(2731.2,676)"><use data-c="31" xlink:href="#MJX-4-TEX-N-31"></use></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><use data-c="1D6FC" xlink:href="#MJX-4-TEX-I-1D6FC"></use></g><g data-mml-node="mo" transform="translate(640,0)"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(1029,0)"><use data-c="1D449" xlink:href="#MJX-4-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(1798,0)"><use data-c="29" xlink:href="#MJX-4-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(2409.2,0)"><use data-c="2B" xlink:href="#MJX-4-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(3409.4,0)"><use data-c="1D6FD" xlink:href="#MJX-4-TEX-I-1D6FD"></use></g><g data-mml-node="mo" transform="translate(3975.4,0)"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(4364.4,0)"><use data-c="1D449" xlink:href="#MJX-4-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(5133.4,0)"><use data-c="29" xlink:href="#MJX-4-TEX-N-29"></use></g></g><rect width="5722.4" height="60" x="120" y="220"></rect></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1401 1 2302"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:4" transform="translate(0,809)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><use data-c="28" xlink:href="#MJX-4-TEX-N-28"></use><use data-c="34" xlink:href="#MJX-4-TEX-N-34" transform="translate(389,0)"></use><use data-c="29" xlink:href="#MJX-4-TEX-N-29" transform="translate(889,0)"></use></g></g></g></g></svg></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd><mtext>(4)</mtext></mtd><mtd><msub><mi>τ</mi><mi>x</mi></msub><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mi>α</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>+</mo><mi>β</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo></mrow></mfrac></mtd></mlabeledtr></mtable></math></mjx-assistive-mml></mjx-container></div></div><p><span>Of course, each membrane current </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.14ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 504 683" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: 0px;"><defs><path id="MJX-12-TEX-I-1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D43C" xlink:href="#MJX-12-TEX-I-1D43C"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">I</script><span> is given by at most two gating variables (here </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.294ex" height="1.025ex" role="img" focusable="false" viewBox="0 -442 572 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.025ex;"><defs><path id="MJX-13-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-13-TEX-I-1D465"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">x</script><span> and </span><mjx-container class="MathJax" jax="SVG" style="position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="1.109ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 490 647" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.464ex;"><defs><path id="MJX-14-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D466" xlink:href="#MJX-14-TEX-I-1D466"></use></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></mjx-assistive-mml></mjx-container><script type="math/tex">y</script><span>) in the form:</span></p><div contenteditable="false" spellcheck="false" class="mathjax-block md-end-block md-math-block md-rawblock" id="mathjax-n75" cid="n75" mdtype="math_block" data-math-tag-before="4" data-math-tag-after="5" data-math-labels="[]"><div class="md-rawblock-container md-math-container" tabindex="-1"><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 32.023ex; position: relative;"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="2.61ex" role="img" focusable="false" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style="vertical-align: -0.74ex; min-width: 32.023ex;"><defs><path id="MJX-5-TEX-I-1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path><path id="MJX-5-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-5-TEX-I-1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path id="MJX-5-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-5-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-5-TEX-I-1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path id="MJX-5-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-5-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-5-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-5-TEX-I-1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path><path id="MJX-5-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-5-TEX-N-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -826.9)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 826.9) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="4999.1 -826.9 1 1153.7"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-76.9)"><g data-mml-node="mtd"><g data-mml-node="mi"><use data-c="1D43C" xlink:href="#MJX-5-TEX-I-1D43C"></use></g><g data-mml-node="mo" transform="translate(504,0)"><use data-c="28" xlink:href="#MJX-5-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(893,0)"><use data-c="1D449" xlink:href="#MJX-5-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(1662,0)"><use data-c="29" xlink:href="#MJX-5-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(2328.8,0)"><use data-c="3D" xlink:href="#MJX-5-TEX-N-3D"></use></g><g data-mml-node="msub" transform="translate(3384.6,0)"><g data-mml-node="mi"><use data-c="1D454" xlink:href="#MJX-5-TEX-I-1D454"></use></g><g data-mml-node="mi" transform="translate(510,-150) scale(0.707)"><use data-c="1D43C" xlink:href="#MJX-5-TEX-I-1D43C"></use></g></g><g data-mml-node="msup" transform="translate(4300.9,0)"><g data-mml-node="mi"><use data-c="1D465" xlink:href="#MJX-5-TEX-I-1D465"></use></g><g data-mml-node="mi" transform="translate(605,413) scale(0.707)"><use data-c="1D44E" xlink:href="#MJX-5-TEX-I-1D44E"></use></g></g><g data-mml-node="msup" transform="translate(5330,0)"><g data-mml-node="mi"><use data-c="1D466" xlink:href="#MJX-5-TEX-I-1D466"></use></g><g data-mml-node="mi" transform="translate(523,413) scale(0.707)"><use data-c="1D44F" xlink:href="#MJX-5-TEX-I-1D44F"></use></g></g><g data-mml-node="mo" transform="translate(6206.3,0)"><use data-c="28" xlink:href="#MJX-5-TEX-N-28"></use></g><g data-mml-node="mi" transform="translate(6595.3,0)"><use data-c="1D449" xlink:href="#MJX-5-TEX-I-1D449"></use></g><g data-mml-node="mo" transform="translate(7586.6,0)"><use data-c="2212" xlink:href="#MJX-5-TEX-N-2212"></use></g><g data-mml-node="msub" transform="translate(8586.8,0)"><g data-mml-node="mi"><use data-c="1D449" xlink:href="#MJX-5-TEX-I-1D449"></use></g><g data-mml-node="mi" transform="translate(616,-150) scale(0.707)"><use data-c="1D43C" xlink:href="#MJX-5-TEX-I-1D43C"></use></g></g><g data-mml-node="mo" transform="translate(9609.2,0)"><use data-c="29" xlink:href="#MJX-5-TEX-N-29"></use></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -826.9 1 1153.7"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:5" transform="translate(0,673.1)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><use data-c="28" xlink:href="#MJX-5-TEX-N-28"></use><use data-c="35" xlink:href="#MJX-5-TEX-N-35" transform="translate(389,0)"></use><use data-c="29" xlink:href="#MJX-5-TEX-N-29" transform="translate(889,0)"></use></g></g></g></g></svg></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="block"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd><mtext>(5)</mtext></mtd><mtd><mi>I</mi><mo stretchy="false">(</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>g</mi><mi>I</mi></msub><msup><mi>x</mi><mi>a</mi></msup><msup><mi>y</mi><mi>b</mi></msup><mo stretchy="false">(</mo><mi>V</mi><mo>−</mo><msub><mi>V</mi><mi>I</mi></msub><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></mjx-assistive-mml></mjx-container></div></div><p><span>So a </span><code>Current</code><span> is represented as:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Currents.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># struct representing a membrane current</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">Current</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">activating</span><span class="cm-builtin">::Union{Gating_Variable,Nothing}</span> &nbsp; <span class="cm-comment"># the activating gating variable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">deactivating</span><span class="cm-builtin">::Union{Gating_Variable,Nothing}</span> <span class="cm-comment"># the inactivating gating variable</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">activating_exponent</span><span class="cm-builtin">::Float64</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">deactivating_exponent</span><span class="cm-builtin">::Float64</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment"># other fields that would just clutter the presentation, hidden from the user by the outer constructors.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment"># ...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 312px;"></div><div class="CodeMirror-gutters" style="display: none; height: 312px;"></div></div></div></pre><p><span>Thus, in the </span><code>Neuron_Parameters.jl</code><span>, you would find the sodium current </span><code>I_Na</code><span> (the </span><em><span>pospischil</span></em><span> interfix reminds of the article this current has been taken from, </span><a href='https://link.springer.com/article/10.1007%2Fs00422-008-0263-8'><span>Pospischil2008</span></a><span>) implemented as :</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Neuron_Parameters.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">##&nbsp;I_Na</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### m</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### αₘ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### (V,p) -&gt; ( m_α_A * ( V - V_T - 13 ) / ( exp( - ( V - V_T - 13 ) / m_α_C) - m_α_D ) )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">αₘ_pospischil_symbols</span> <span class="cm-operator">=</span> [<span class="cm-builtin">:m_α_A</span> ,<span class="cm-builtin">:V_T</span>,<span class="cm-builtin">:m_α_C</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">αₘ_pospischil_evaluation</span>(<span class="cm-variable">V</span>,<span class="cm-variable">p</span>) <span class="cm-operator">=</span> ( <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">1</span>] <span class="cm-operator">*</span> ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">2</span>] <span class="cm-operator">-</span> <span class="cm-number">13.0</span> ) <span class="cm-operator">/</span> ( <span class="cm-builtin">exp</span>( <span class="cm-operator">-</span> ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">2</span>] <span class="cm-operator">-</span> <span class="cm-number">13.0</span> ) <span class="cm-operator">/</span> <span class="cm-variable">p</span>[<span class="cm-number">3</span>]) <span class="cm-operator">-</span> <span class="cm-number">1.0</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">αₘ_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable_Rate</span>(<span class="cm-variable">αₘ_pospischil_symbols</span>,<span class="cm-variable">αₘ_pospischil_evaluation</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### βₘ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### ( m_β_A * ( V_rest - V_T - 40 ) / ( exp( ( V_rest - V_T - 40 ) / m_β_C) - m_β_D ) )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">βₘ_pospischil_symbols</span> <span class="cm-operator">=</span> [<span class="cm-builtin">:m_β_A</span>,<span class="cm-builtin">:V_T</span>, <span class="cm-builtin">:m_β_C</span> ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">βₘ_pospischil_evaluation</span>(<span class="cm-variable">V</span>,<span class="cm-variable">p</span>) <span class="cm-operator">=</span>  ( <span class="cm-variable">p</span>[<span class="cm-number">1</span>] <span class="cm-operator">*</span> ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">2</span>] <span class="cm-operator">-</span> <span class="cm-number">40</span> ) <span class="cm-operator">/</span> ( <span class="cm-builtin">exp</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">2</span>] <span class="cm-operator">-</span> <span class="cm-number">40</span> ) <span class="cm-operator">/</span> <span class="cm-variable">p</span>[<span class="cm-number">3</span>]) <span class="cm-operator">-</span> <span class="cm-number">1.0</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">βₘ_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable_Rate</span>(<span class="cm-variable">βₘ_pospischil_symbols</span>, <span class="cm-variable">βₘ_pospischil_evaluation</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">m_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable</span>(<span class="cm-builtin">:m</span>, <span class="cm-variable">α</span> <span class="cm-operator">=</span> <span class="cm-variable">αₘ_pospischil</span>, <span class="cm-variable">β</span> <span class="cm-operator">=</span> &nbsp;<span class="cm-variable">βₘ_pospischil</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">### h</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### αₕ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### (V,p) -&gt;  ( h_α_A * exp( - ( V_rest - V_T - 17 ) / h_α_C ) )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">αₕ_pospischil_symbols</span> <span class="cm-operator">=</span> [<span class="cm-builtin">:h_α_A</span> ,<span class="cm-builtin">:V_T</span> , <span class="cm-builtin">:h_α_C</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">αₕ_pospischil_evaluation</span>(<span class="cm-variable">V</span>,<span class="cm-variable">p</span>) <span class="cm-operator">=</span>  ( <span class="cm-variable">p</span>[<span class="cm-number">1</span>] <span class="cm-operator">*</span> <span class="cm-builtin">exp</span>( <span class="cm-operator">-</span> ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">2</span>] <span class="cm-operator">-</span> <span class="cm-number">17.0</span> ) <span class="cm-operator">/</span> <span class="cm-variable">p</span>[<span class="cm-number">3</span>] ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">αₕ_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable_Rate</span>(<span class="cm-variable">αₕ_pospischil_symbols</span>, <span class="cm-variable">αₕ_pospischil_evaluation</span>  )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### βₕ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#### ( m_β_A * ( V_rest - V_T - 40 ) / ( exp( ( V_rest - V_T - 40 ) / m_β_C) - m_β_D ) )</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">βₕ_pospischil_symbols</span> <span class="cm-operator">=</span> [<span class="cm-builtin">:h_β_A</span>,<span class="cm-builtin">:V_T</span> ,<span class="cm-builtin">:h_β_C</span> ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">βₕ_pospischil_evaluation</span>(<span class="cm-variable">V</span>,<span class="cm-variable">p</span>) <span class="cm-operator">=</span>  ( <span class="cm-variable">p</span>[<span class="cm-number">1</span>] <span class="cm-operator">/</span> ( <span class="cm-number">1.0</span> <span class="cm-operator">+</span> <span class="cm-builtin">exp</span>( <span class="cm-operator">-</span> ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">p</span>[<span class="cm-number">2</span>] <span class="cm-operator">-</span> <span class="cm-number">40.0</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">p</span>[<span class="cm-number">3</span>]) ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">βₕ_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable_Rate</span>(<span class="cm-variable">βₕ_pospischil_symbols</span>, <span class="cm-variable">βₕ_pospischil_evaluation</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">h_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Gating_Variable</span>(<span class="cm-builtin">:h</span>, <span class="cm-variable">α</span> <span class="cm-operator">=</span> <span class="cm-variable">αₕ_pospischil</span>, &nbsp;<span class="cm-variable">β</span> <span class="cm-operator">=</span> &nbsp; <span class="cm-variable">βₕ_pospischil</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">I_Na_pospischil</span> <span class="cm-operator">=</span> <span class="cm-builtin">Current</span>(<span class="cm-variable">m_pospischil</span>, <span class="cm-variable">h_pospischil</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 910px;"></div><div class="CodeMirror-gutters" style="display: none; height: 910px;"></div></div></div></pre><p><span>This last snippet shows how the user may define his own currents. In the next paragraph we shall see how currents are used to switch from the GVRF to the BTF.</span></p><h3 id='22-hh-type-model-definition-and-formalism-switching'><span>2.2 HH-type Model definition and formalism switching</span></h3><p><span>Let us now turn to model definition. In the future, we plan to make it way easier (see section </span><a href='#hh-type-model-definition'><span>HH-type model definition</span></a><span>), but for now the user should just adopt the standard DifferentialEquations.jl interface. The name of the following model is to be interpreted as &quot;HH-type model containing the </span><code>Na</code><span>, </span><code>Kd</code><span>, </span><code>M</code><span> and </span><code>L</code><span> current (taken from </span><a href='https://link.springer.com/article/10.1007%2Fs00422-008-0263-8'><span>Pospischil2008</span></a><span>)&quot;.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># HH__Na_Kd_M_L.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## BT deterministic_dynamic</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">HH__Na_Kd_M_L_BT_deterministic_dynamic!</span>(<span class="cm-variable">I_series</span><span class="cm-builtin">::F</span>) <span class="cm-variable">where</span> {<span class="cm-variable">F</span> <span class="cm-operator">&lt;</span><span class="cm-builtin">:Function</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-def">parametrized_HH__Na_Kd_M_L_BT_deterministic_dynamic!</span>(<span class="cm-variable">du</span>, <span class="cm-variable">u</span>, <span class="cm-variable">p</span>, <span class="cm-variable">t</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">C</span>, &nbsp; <span class="cm-variable">g_Na</span>, <span class="cm-variable">V_Na</span>, <span class="cm-variable">g_K</span>, &nbsp; &nbsp; <span class="cm-variable">g_M</span>, &nbsp; <span class="cm-variable">V_K</span>, &nbsp; <span class="cm-variable">g_L</span>, <span class="cm-variable">V_Ca</span>, <span class="cm-variable">g_l</span>, <span class="cm-variable">V_l</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V_m</span>, <span class="cm-variable">κ_m</span>, &nbsp;<span class="cm-variable">τ₀_m</span>, <span class="cm-variable">τ_max_m</span>, <span class="cm-variable">V_τ_m</span>, <span class="cm-variable">σ_m</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V_h</span>, <span class="cm-variable">κ_h</span>, &nbsp;<span class="cm-variable">τ₀_h</span>, <span class="cm-variable">τ_max_h</span>, <span class="cm-variable">V_τ_h</span>, <span class="cm-variable">σ_h</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V_n</span>, <span class="cm-variable">κ_n</span>, &nbsp;<span class="cm-variable">τ₀_n</span>, <span class="cm-variable">τ_max_n</span>, <span class="cm-variable">V_τ_n</span>, <span class="cm-variable">σ_n</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V_p</span>, <span class="cm-variable">κ_p</span>, &nbsp;<span class="cm-variable">τ₀_p</span>, <span class="cm-variable">τ_max_p</span>, <span class="cm-variable">V_τ_p</span>, <span class="cm-variable">σ_p</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V_q</span>, <span class="cm-variable">κ_q</span>, &nbsp;<span class="cm-variable">τ₀_q</span>, <span class="cm-variable">τ_max_q</span>, <span class="cm-variable">V_τ_q</span>, <span class="cm-variable">σ_q</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V_r</span>, <span class="cm-variable">κ_r</span>, &nbsp;<span class="cm-variable">τ₀_r</span>, <span class="cm-variable">τ_max_r</span>, <span class="cm-variable">V_τ_r</span>, <span class="cm-variable">σ_r</span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">=</span> <span class="cm-variable">p</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># State variables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">V</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">1</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">2</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">h</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">3</span>] </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">4</span>] </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">5</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">q</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">6</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">r</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">u</span>[<span class="cm-number">7</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># State variables</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dV</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">1</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dm</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">2</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dh</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">3</span>] </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dn</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">4</span>] </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dp</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">5</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dq</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">6</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dr</span> <span class="cm-operator">=</span> <span class="cm-meta">@view</span> <span class="cm-variable">du</span>[<span class="cm-number">7</span>]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dV</span> <span class="cm-operator">.=</span> (<span class="cm-operator">.-</span><span class="cm-number">1.0</span> <span class="cm-operator">./</span> <span class="cm-variable">C</span> ) <span class="cm-operator">.*</span> ( <span class="cm-variable">g_Na</span> <span class="cm-operator">.*</span> (<span class="cm-variable">m</span> <span class="cm-operator">.^</span> <span class="cm-number">3</span>) <span class="cm-operator">.*</span> <span class="cm-variable">h</span> <span class="cm-operator">.*</span> ( <span class="cm-variable">V</span> <span class="cm-operator">.-</span> <span class="cm-variable">V_Na</span> ) <span class="cm-operator">.+</span> <span class="cm-variable">g_K</span> <span class="cm-operator">.*</span> (<span class="cm-variable">n</span> <span class="cm-operator">.^</span> <span class="cm-number">4</span> ) <span class="cm-operator">.*</span> ( <span class="cm-variable">V</span> <span class="cm-operator">.-</span> <span class="cm-variable">V_K</span> ) <span class="cm-operator">.+</span> <span class="cm-variable">g_M</span> <span class="cm-operator">.*</span> <span class="cm-variable">p</span> <span class="cm-operator">.*</span> (<span class="cm-variable">V</span> <span class="cm-operator">.-</span> <span class="cm-variable">V_K</span>) <span class="cm-operator">.+</span> <span class="cm-variable">g_L</span> <span class="cm-operator">.*</span> (<span class="cm-variable">q</span><span class="cm-operator">.^</span><span class="cm-number">2</span>)<span class="cm-operator">*</span><span class="cm-variable">r</span><span class="cm-operator">*</span>(<span class="cm-variable">V</span> <span class="cm-operator">.-</span> <span class="cm-variable">V_Ca</span> ) <span class="cm-operator">.+</span> <span class="cm-variable">g_l</span> <span class="cm-operator">.*</span> ( <span class="cm-variable">V</span> <span class="cm-operator">.-</span> <span class="cm-variable">V_l</span> ) <span class="cm-operator">.-</span> <span class="cm-builtin">I_series</span>(<span class="cm-variable">t</span>) &nbsp; )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-error">@.</span> <span class="cm-variable">dm</span> <span class="cm-operator">=</span> ( (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_m</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_m</span> ) ) <span class="cm-operator">-</span> <span class="cm-variable">m</span> ) <span class="cm-operator">/</span> ( <span class="cm-variable">τ₀_m</span> <span class="cm-operator">+</span> <span class="cm-variable">τ_max_m</span> <span class="cm-operator">*</span> ( <span class="cm-number">1</span> <span class="cm-operator">-</span> <span class="cm-builtin">tanh</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_τ_m</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">σ_m</span> ) <span class="cm-operator">^</span> <span class="cm-number">2</span> ) ) &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-error">@.</span> <span class="cm-variable">dh</span> <span class="cm-operator">=</span> ( (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_h</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_h</span> ) ) <span class="cm-operator">-</span> <span class="cm-variable">h</span> ) <span class="cm-operator">/</span> ( <span class="cm-variable">τ₀_h</span> <span class="cm-operator">+</span> <span class="cm-variable">τ_max_h</span> <span class="cm-operator">*</span> ( <span class="cm-number">1</span> <span class="cm-operator">-</span> <span class="cm-builtin">tanh</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_τ_h</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">σ_h</span> ) <span class="cm-operator">^</span> <span class="cm-number">2</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-error">@.</span> <span class="cm-variable">dn</span> <span class="cm-operator">=</span> ( (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_n</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_n</span> ) ) <span class="cm-operator">-</span> <span class="cm-variable">n</span> ) <span class="cm-operator">/</span> ( <span class="cm-variable">τ₀_n</span> <span class="cm-operator">+</span> <span class="cm-variable">τ_max_n</span> <span class="cm-operator">*</span> ( <span class="cm-number">1</span> <span class="cm-operator">-</span> <span class="cm-builtin">tanh</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_τ_n</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">σ_n</span> ) <span class="cm-operator">^</span> <span class="cm-number">2</span> ) ) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-error">@.</span> <span class="cm-variable">dp</span> <span class="cm-operator">=</span> ( (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_p</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_p</span> ) ) <span class="cm-operator">-</span> <span class="cm-variable">p</span> ) <span class="cm-operator">/</span> ( <span class="cm-variable">τ₀_p</span> <span class="cm-operator">+</span> <span class="cm-variable">τ_max_p</span> <span class="cm-operator">*</span> ( <span class="cm-number">1</span> <span class="cm-operator">-</span> <span class="cm-builtin">tanh</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_τ_p</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">σ_p</span> ) <span class="cm-operator">^</span> <span class="cm-number">2</span> ) ) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-error">@.</span> <span class="cm-variable">dq</span> <span class="cm-operator">=</span> ( (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_q</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_q</span> ) ) <span class="cm-operator">-</span> <span class="cm-variable">q</span> ) <span class="cm-operator">/</span> ( <span class="cm-variable">τ₀_q</span> <span class="cm-operator">+</span> <span class="cm-variable">τ_max_q</span> <span class="cm-operator">*</span> ( <span class="cm-number">1</span> <span class="cm-operator">-</span> <span class="cm-builtin">tanh</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_τ_q</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">σ_q</span> ) <span class="cm-operator">^</span> <span class="cm-number">2</span> ) ) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-error">@.</span> <span class="cm-variable">dr</span> <span class="cm-operator">=</span> ( (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_r</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_r</span> ) ) <span class="cm-operator">-</span> <span class="cm-variable">r</span> ) <span class="cm-operator">/</span> ( <span class="cm-variable">τ₀_r</span> <span class="cm-operator">+</span> <span class="cm-variable">τ_max_r</span> <span class="cm-operator">*</span> ( <span class="cm-number">1</span> <span class="cm-operator">-</span> <span class="cm-builtin">tanh</span>( ( <span class="cm-variable">V</span> <span class="cm-operator">-</span> <span class="cm-variable">V_τ_r</span>  ) <span class="cm-operator">/</span> <span class="cm-variable">σ_r</span> ) <span class="cm-operator">^</span> <span class="cm-number">2</span> ) ) </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## noise</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">HH__Na_Kd_M_L_noise!</span>()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">function</span> <span class="cm-def">parameterized_HH__Na_Kd_M_L__noise!</span>(<span class="cm-variable">du</span>, <span class="cm-variable">u</span>, <span class="cm-variable">p</span>, <span class="cm-variable">t</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">du</span> <span class="cm-operator">.=</span> <span class="cm-builtin">repeat</span>([<span class="cm-number">0.0</span>], <span class="cm-number">7</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1586px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1586px;"></div></div></div></pre><p><span>Notice that we didn&#39;t report here the GVRF dynamics: it is not needed.</span></p><p><span>Usually one finds the HH models and parameters values in the GVRF in the literature, but may want to switch to the BTF for better computational performance. This means that the reasearcher usually knows the GVRF parameters values (Cfr. the code above):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">C</span>, &nbsp; &nbsp; <span class="cm-variable">g_Na</span>, &nbsp;<span class="cm-variable">V_Na</span>, &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">g_K</span>, &nbsp; <span class="cm-variable">g_M</span>, &nbsp; <span class="cm-variable">V_K</span>, &nbsp; <span class="cm-variable">g_L</span>, &nbsp; <span class="cm-variable">V_Ca</span>, &nbsp;<span class="cm-variable">g_l</span>, <span class="cm-variable">V_l</span>, <span class="cm-variable">V_T</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">m_α_A</span>, <span class="cm-variable">m_α_C</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">m_β_A</span>, <span class="cm-variable">m_β_C</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">h_α_A</span>, <span class="cm-variable">h_α_C</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">h_β_A</span>, <span class="cm-variable">h_β_C</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">n_α_A</span>, <span class="cm-variable">n_α_C</span>, &nbsp; &nbsp; &nbsp; <span class="cm-tab" role="presentation" cm-text="	">  </span> &nbsp; <span class="cm-variable">n_β_A</span>, <span class="cm-variable">n_β_C</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">p_0_B</span>, <span class="cm-variable">p_0_C</span>, <span class="cm-variable">τ_p_max_exp</span>, <span class="cm-variable">τ_p_A</span>, <span class="cm-variable">τ_p_B</span>, <span class="cm-variable">τ_p_C</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">q_α_A</span>, <span class="cm-variable">q_α_B</span>, <span class="cm-variable">q_α_C</span>, &nbsp; &nbsp; &nbsp; <span class="cm-variable">q_β_A</span>, <span class="cm-variable">q_β_B</span>, <span class="cm-variable">q_β_C</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">r_α_A</span>, <span class="cm-variable">r_α_B</span>, <span class="cm-variable">r_α_C</span>, &nbsp; &nbsp; &nbsp; <span class="cm-variable">r_β_A</span>, <span class="cm-variable">r_β_B</span>, <span class="cm-variable">r_β_C</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 182px;"></div><div class="CodeMirror-gutters" style="display: none; height: 182px;"></div></div></div></pre><p><span>And wants to calculate the corresponding BTF parameters values so that each current&#39;s dynamical role is preserved (Cfr. the code above):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-variable">C</span>, &nbsp; <span class="cm-variable">g_Na</span>, <span class="cm-variable">V_Na</span>, <span class="cm-variable">g_K</span>, &nbsp; &nbsp; <span class="cm-variable">g_M</span>, &nbsp; <span class="cm-variable">V_K</span>, &nbsp; <span class="cm-variable">g_L</span>, <span class="cm-variable">V_Ca</span>, <span class="cm-variable">g_l</span>, <span class="cm-variable">V_l</span>,</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">V_m</span>, <span class="cm-variable">κ_m</span>, &nbsp;<span class="cm-variable">τ₀_m</span>, <span class="cm-variable">τ_max_m</span>, <span class="cm-variable">V_τ_m</span>, <span class="cm-variable">σ_m</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">V_h</span>, <span class="cm-variable">κ_h</span>, &nbsp;<span class="cm-variable">τ₀_h</span>, <span class="cm-variable">τ_max_h</span>, <span class="cm-variable">V_τ_h</span>, <span class="cm-variable">σ_h</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">V_n</span>, <span class="cm-variable">κ_n</span>, &nbsp;<span class="cm-variable">τ₀_n</span>, <span class="cm-variable">τ_max_n</span>, <span class="cm-variable">V_τ_n</span>, <span class="cm-variable">σ_n</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">V_p</span>, <span class="cm-variable">κ_p</span>, &nbsp;<span class="cm-variable">τ₀_p</span>, <span class="cm-variable">τ_max_p</span>, <span class="cm-variable">V_τ_p</span>, <span class="cm-variable">σ_p</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">V_q</span>, <span class="cm-variable">κ_q</span>, &nbsp;<span class="cm-variable">τ₀_q</span>, <span class="cm-variable">τ_max_q</span>, <span class="cm-variable">V_τ_q</span>, <span class="cm-variable">σ_q</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">V_r</span>, <span class="cm-variable">κ_r</span>, &nbsp;<span class="cm-variable">τ₀_r</span>, <span class="cm-variable">τ_max_r</span>, <span class="cm-variable">V_τ_r</span>, <span class="cm-variable">σ_r</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 182px;"></div><div class="CodeMirror-gutters" style="display: none; height: 182px;"></div></div></div></pre><p><span>The researcher also wants to get the BTF equations from the GVRF equations, but this is straightforward since all BTF equations usually have the exact same form (more about it in the </span><a href='#BTF functional forms'><span>BTF functional forms</span></a><span> future development section), so one just needs to care about the number of them. In the following, we show how the pipeline eases this process.</span></p><p><span>From </span><a href='https://link.springer.com/article/10.1007%2Fs00422-008-0263-8'><span>Pospischil2008</span></a><span>  we extracted al the GVRF parameters values and coded them in a dictionary </span><code>GVRF_parameters_values</code><span> and placed it in the </span><code>Neuron_Parameters.jl</code><span> then we wrote the BTF model in the </span><code>parametrized_HH__Na_Kd_M_L_BTF_deterministic_dynamic</code><span> enclosed function (from a coding point of view it is a straightforward procedure, since BTF equations are all the same) . The last </span><code>HH__Na_Kd_M_L_noise!</code><span> closure is there for compatibility with Bayesian parameter estimation methods, but we won&#39;t go into the details of this here, so we will just leave it null.</span></p><p><span>A dedicated set of functionalities allows for automatically getting the parameters values for the BTF from the GVRF parameters values. Infact, in the </span><code>main.jl</code><span> we have:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">BTF_parameters_values</span>,<span class="cm-variable">BTF_currents</span> <span class="cm-operator">=</span> <span class="cm-builtin">convert_GVRF_parameters_to_BTF_parameters</span>([<span class="cm-variable">I_Na_pospischil</span>, <span class="cm-variable">I_Kd_pospischil</span>, <span class="cm-variable">I_M_pospischil</span>, <span class="cm-variable">I_L_pospischil</span> ], <span class="cm-variable">GVRF_parameters_values</span>, <span class="cm-variable">plots</span> <span class="cm-operator">=</span> <span class="cm-builtin">true</span>  )</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="display: none; height: 104px;"></div></div></div></pre><p><span>Where </span><code>I_Na_pospischil, I_Kd_pospischil, I_M_pospischil, I_L_pospischil</code><span> are all </span><code>Current</code><span>s written in the GVRF, while </span><code>GVRF_parameters_values</code><span> are the default GVRF parameters values derived from </span><a href='https://link.springer.com/article/10.1007%2Fs00422-008-0263-8'><span>Pospischil2008</span></a><span>,</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">julia</span><span class="cm-operator">&gt;</span> <span class="cm-variable">GVRF_parameters_values</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">OrderedDict{Symbol,Float64}</span>( <span class="cm-builtin">:C</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">1.0</span> &nbsp; , <span class="cm-builtin">:g_Na</span> &nbsp; &nbsp;<span class="cm-operator">=&gt;</span> <span class="cm-number">50.0</span>, <span class="cm-builtin">:V_Na</span> &nbsp;<span class="cm-operator">=&gt;</span> <span class="cm-number">50.0</span>, <span class="cm-builtin">:g_K</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">5.0</span>, <span class="cm-builtin">:g_M</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.004</span> , <span class="cm-builtin">:V_K</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">90.0</span>, <span class="cm-builtin">:g_L</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.1</span>, <span class="cm-builtin">:V_Ca</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">120.0</span>, &nbsp;<span class="cm-builtin">:g_l</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.01</span>, <span class="cm-builtin">:V_l</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">70.61</span>, &nbsp;<span class="cm-builtin">:V_T</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">50.0</span> , </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:m_α_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.32</span> &nbsp;  , <span class="cm-builtin">:m_α_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">4.0</span> , &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># αₘ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:m_β_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.28</span> &nbsp;  , <span class="cm-builtin">:m_β_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">5.0</span> , &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># βₘ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:h_α_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.128</span> &nbsp; , <span class="cm-builtin">:h_α_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">18.0</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># αₕ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:h_β_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">4.0</span> &nbsp; &nbsp; , <span class="cm-builtin">:h_β_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">5.0</span> , &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># βₕ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:n_α_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.032</span> &nbsp; , <span class="cm-builtin">:n_α_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">5.0</span> , &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># αₙ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:n_β_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.5</span> &nbsp; &nbsp; , <span class="cm-builtin">:n_β_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">40.0</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># βₙ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:p_0_B</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">35.0</span> &nbsp;  , <span class="cm-builtin">:p_0_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">10.0</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># p_x₀</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:τ_p_max_exp</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">4000.0</span>  , <span class="cm-builtin">:τ_p_A</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">3.3</span> , <span class="cm-builtin">:τ_p_B</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">35.0</span>, <span class="cm-builtin">:τ_p_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">20.0</span>, &nbsp;<span class="cm-comment"># p_τ</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:q_α_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.055</span> &nbsp; , <span class="cm-builtin">:q_α_B</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">27.0</span>, <span class="cm-builtin">:q_α_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">3.8</span> , &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># α_q</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:q_β_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.94</span> &nbsp;  , <span class="cm-builtin">:q_β_B</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">75.0</span>, <span class="cm-builtin">:q_β_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">17.0</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># β_q</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:r_α_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.000457</span>, <span class="cm-builtin">:r_α_B</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">13.0</span>, <span class="cm-builtin">:r_α_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">50.0</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># α_r</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-builtin">:r_β_A</span> &nbsp; &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">0.0065</span>  , <span class="cm-builtin">:r_β_B</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">15.0</span>, <span class="cm-builtin">:r_β_C</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">28.0</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment"># β_r </span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 546px;"></div><div class="CodeMirror-gutters" style="display: none; height: 546px;"></div></div></div></pre><p><span>The </span><code>plots</code><span> argument allows for a visual check that the fitting of the gating variables </span><code>m</code><span>,</span><code>n</code><span> etc according to the BTF functional forms was ok. It proved to be a good way of debugging copy-pasted BT and GVRF models. See </span><a href='#BTF functional forms'><span>BTF functional forms</span></a><span> to read how we may improve this process. The </span><code>BTF_parameters_values</code><span> is a dictionary containing the parameters values in the BTF:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">julia</span><span class="cm-operator">&gt;</span> <span class="cm-variable">BTF_parameters_values</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">OrderedDict{Symbol,Float64}</span>( <span class="cm-builtin">:C</span> &nbsp; &nbsp; <span class="cm-operator">=&gt;</span> <span class="cm-number">1.0</span> &nbsp; , <span class="cm-builtin">:g_Na</span> &nbsp;<span class="cm-operator">=&gt;</span> <span class="cm-number">50.0</span>, <span class="cm-builtin">:V_Na</span> &nbsp;<span class="cm-operator">=&gt;</span> <span class="cm-number">50.0</span>, <span class="cm-builtin">:g_K</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">5.0</span>, <span class="cm-builtin">:g_M</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.004</span> , <span class="cm-builtin">:V_K</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">90.0</span>, <span class="cm-builtin">:g_L</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.1</span>, <span class="cm-builtin">:V_Ca</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">120.0</span>, &nbsp;<span class="cm-builtin">:g_l</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.01</span>, <span class="cm-builtin">:V_l</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">70.61</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">:V_m</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">24.289</span>, <span class="cm-builtin">:κ_m</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">15.923</span>, &nbsp; <span class="cm-builtin">:τ₀_m</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.0287668</span>,<span class="cm-builtin">:τ_max_m</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.0902789</span>, <span class="cm-builtin">:V_τ_m</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">28.367</span>, <span class="cm-builtin">:σ_m</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">42.521</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">:V_h</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">28.37</span>, &nbsp;<span class="cm-builtin">:κ_h</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">7.98066</span>, <span class="cm-builtin">:τ₀_h</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.029524</span>, <span class="cm-builtin">:τ_max_h</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">5.93525</span>, &nbsp; <span class="cm-builtin">:V_τ_h</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">33.409</span>, <span class="cm-builtin">:σ_h</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">14.874</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">:V_n</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">25.782</span>, <span class="cm-builtin">:κ_n</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">20.8588</span>, &nbsp;<span class="cm-builtin">:τ₀_n</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.169517</span>, <span class="cm-builtin">:τ_max_n</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">1.51954</span>, &nbsp; <span class="cm-builtin">:V_τ_n</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">38.718</span>, <span class="cm-builtin">:σ_n</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">34.855</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">:V_p</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">35.0</span>, &nbsp; <span class="cm-builtin">:κ_p</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">20.0</span>, &nbsp; &nbsp; <span class="cm-builtin">:τ₀_p</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">14.836</span>, &nbsp; <span class="cm-builtin">:τ_max_p</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">1086.13</span>, &nbsp; <span class="cm-builtin">:V_τ_p</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">46.939</span>, <span class="cm-builtin">:σ_p</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">30.256</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">:V_q</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">33.337</span>, <span class="cm-builtin">:κ_q</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">8.87387</span>, &nbsp;<span class="cm-builtin">:τ₀_q</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.025755</span>, <span class="cm-builtin">:τ_max_q</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">7.01596</span>, &nbsp; <span class="cm-builtin">:V_τ_q</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">38.257</span>, <span class="cm-builtin">:σ_q</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">15.475</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">:V_r</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">58.488</span>, <span class="cm-builtin">:κ_r</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">40.4226</span>, <span class="cm-builtin">:τ₀_r</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">99.961</span>, &nbsp; <span class="cm-builtin">:τ_max_r</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">349.793</span>, &nbsp; <span class="cm-builtin">:V_τ_r</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">67.161</span>, <span class="cm-builtin">:σ_r</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">65.92</span> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 468px;"></div><div class="CodeMirror-gutters" style="display: none; height: 468px;"></div></div></div></pre><p><span>While </span><code>BTF_currents</code><span> is an array of </span><code>Current</code><span>s written in the BTF. For calibration purposes, some algorithms need priors for those parameters. Since, to the best of our knowledge, such priors are often specified as ranges, we implemented a function that returns, for each parameter, a </span><code>Uniform</code><span> prior centered on its value and spanning a user-defined interval measured in orders of magnitude (</span><code>range</code><span>):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">parameters_priors_HH__Na_Kd_M_L_BTF</span> <span class="cm-operator">=</span> <span class="cm-builtin">get_uniform_priors</span>(<span class="cm-variable">BTF_parameters_values</span>, <span class="cm-variable">range</span> <span class="cm-operator">=</span> <span class="cm-number">1</span> )</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 78px;"></div><div class="CodeMirror-gutters" style="display: none; height: 78px;"></div></div></div></pre><p><span>Initial conditions of (compartmental) models depend on parameters values (and resting potential, see </span><a href='http://indico.ictp.it/event/a13235/session/99/contribution/371/material/0/1.pdf'><span>indico.ictp</span></a><span>), so now that we have initial parameters values we may continue our HH-type model instantiation . This order is not compulsory and further arguments may be needed depending on the application, but we won&#39;t go into these details.</span></p><h3 id='23-hh-type-model-instantiation'><span>2.3 HH-type model instantiation</span></h3><p><span>Our framework represents a model with a dedicated struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># HH_Model.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">HH_model</span>{<span class="cm-variable">D</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span>, <span class="cm-variable">N</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Union</span>{<span class="cm-variable">Nothing</span>, <span class="cm-variable">Function</span>}, <span class="cm-variable">E</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span> } <span class="cm-operator">&lt;:</span> <span class="cm-variable">AbstractDiffEqSystem</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">deterministic_dynamic</span><span class="cm-builtin">::D</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">noise</span><span class="cm-builtin">::N</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">calibration_history</span><span class="cm-builtin">::Calibration_History</span> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">IC_evaluation_function</span><span class="cm-builtin">::E</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">model_kwargs</span><span class="cm-builtin">::NamedTuple{&lt;:Any, &lt;:Tuple{Vararg{Any}}}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 260px;"></div><div class="CodeMirror-gutters" style="display: none; height: 260px;"></div></div></div></pre><p><span>Where:</span></p><ul><li><code>deterministic_dynamic</code><span>: in our case, this would correspond to the deterministic dynamic closure </span><code>HH__Na_Kd_M_L_deterministic_dynamic!</code><span> ;</span></li><li><code>noise</code><span>: the pipeline supports Bayesian parameter optimization (here not covered), featuring integration with </span><a href='https://github.com/TuringLang/Turing.jl'><span>Turing.jl</span></a><span>. In this report it will be set to a null system ;</span></li><li><code>calibration_history</code><span>: this field keeps track of the calibrated parameters, initial conditions and (multivariate) posteriors during calibration, here not covered. This can be initialized with initial parameters values and initial conditions ;</span></li><li><code>model_kwargs</code><span>: allows for passing arguments to </span><code>deterministic_dynamic</code><span>and </span><code>noise</code><span> during calibration ;</span></li><li><code>IC_evaluation_function</code><span>: the field representing the function used to calculate initial conditions from resting potential and parameters values. The user should implement this function at least for the BTF, following the boilerplate:</span></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># HH__Na_Kd_M_L.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## see indico.ictp : http://indico.ictp.it/event/a13235/session/99/contribution/371/material/0/1.pdf</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">get_HH__Na_Kd_M_L_BTF_IC</span>(<span class="cm-variable">V_rest</span><span class="cm-builtin">::Float64</span>, <span class="cm-variable">all_parameters_values</span><span class="cm-builtin">::Vector{Float64}</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">C</span>, &nbsp; <span class="cm-variable">g_Na</span>, <span class="cm-variable">V_Na</span>, <span class="cm-variable">g_K</span>, &nbsp; &nbsp; <span class="cm-variable">g_M</span>, &nbsp; <span class="cm-variable">V_K</span>, &nbsp; <span class="cm-variable">g_L</span>, <span class="cm-variable">V_Ca</span>, <span class="cm-variable">g_l</span>, <span class="cm-variable">V_l</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V_m</span>, <span class="cm-variable">κ_m</span>, &nbsp;<span class="cm-variable">τ₀_m</span>, <span class="cm-variable">τ_max_m</span>, <span class="cm-variable">V_τ_m</span>, <span class="cm-variable">σ_m</span>, </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V_h</span>, <span class="cm-variable">κ_h</span>, &nbsp;<span class="cm-variable">τ₀_h</span>, <span class="cm-variable">τ_max_h</span>, <span class="cm-variable">V_τ_h</span>, <span class="cm-variable">σ_h</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V_n</span>, <span class="cm-variable">κ_n</span>, &nbsp;<span class="cm-variable">τ₀_n</span>, <span class="cm-variable">τ_max_n</span>, <span class="cm-variable">V_τ_n</span>, <span class="cm-variable">σ_n</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V_p</span>, <span class="cm-variable">κ_p</span>, &nbsp;<span class="cm-variable">τ₀_p</span>, <span class="cm-variable">τ_max_p</span>, <span class="cm-variable">V_τ_p</span>, <span class="cm-variable">σ_p</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V_q</span>, <span class="cm-variable">κ_q</span>, &nbsp;<span class="cm-variable">τ₀_q</span>, <span class="cm-variable">τ_max_q</span>, <span class="cm-variable">V_τ_q</span>, <span class="cm-variable">σ_q</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">V_r</span>, <span class="cm-variable">κ_r</span>, &nbsp;<span class="cm-variable">τ₀_r</span>, <span class="cm-variable">τ_max_r</span>, <span class="cm-variable">V_τ_r</span>, <span class="cm-variable">σ_r</span> &nbsp; &nbsp; <span class="cm-operator">=</span> <span class="cm-variable">all_parameters_values</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">m₀</span><span class="cm-builtin">::Float64</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V_rest</span> <span class="cm-operator">-</span> <span class="cm-variable">V_m</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_m</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">h₀</span><span class="cm-builtin">::Float64</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V_rest</span> <span class="cm-operator">-</span> <span class="cm-variable">V_h</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_h</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">n₀</span><span class="cm-builtin">::Float64</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V_rest</span> <span class="cm-operator">-</span> <span class="cm-variable">V_n</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_n</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">p₀</span><span class="cm-builtin">::Float64</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V_rest</span> <span class="cm-operator">-</span> <span class="cm-variable">V_p</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_p</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">q₀</span><span class="cm-builtin">::Float64</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V_rest</span> <span class="cm-operator">-</span> <span class="cm-variable">V_q</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_q</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">r₀</span><span class="cm-builtin">::Float64</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span><span class="cm-operator">/</span><span class="cm-number">2</span>) <span class="cm-operator">*</span> (<span class="cm-number">1</span> <span class="cm-operator">+</span> <span class="cm-builtin">tanh</span>( (<span class="cm-variable">V_rest</span> <span class="cm-operator">-</span> <span class="cm-variable">V_r</span>) <span class="cm-operator">/</span> <span class="cm-variable">κ_r</span> ) )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-builtin">vcat</span>(<span class="cm-variable">V_rest</span>, <span class="cm-variable">m₀</span>, <span class="cm-variable">h₀</span>, <span class="cm-variable">n₀</span>, <span class="cm-variable">p₀</span>, <span class="cm-variable">q₀</span>, <span class="cm-variable">r₀</span> )</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 546px;"></div><div class="CodeMirror-gutters" style="display: none; height: 546px;"></div></div></div></pre><p><span>Thus one may instantiate the model via a dedicated constructor:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HH__Na_Kd_M_L_BTF</span><span class="cm-operator">=</span> <span class="cm-builtin">Compartmental_Model</span>(<span class="cm-variable">HH__Na_Kd_M_L_BTF_deterministic_dynamic!</span>, <span class="cm-variable">parameters_symbols_HH__Na_Kd_M_L_BTF</span>, <span class="cm-variable">parameters_priors_HH__Na_Kd_M_L_BTF</span>, <span class="cm-variable">get_HH__Na_Kd_M_L_BTF_IC</span>; <span class="cm-variable">initial_parameters_values</span> <span class="cm-operator">=</span> <span class="cm-variable">BTF_parameters_values</span>);</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre><p><span>Let us now turn to experimental dataset loading.</span></p><h3 id='dataset-loading'><span>Dataset loading</span></h3><p><span>As already stated, the pipeline is interfaced to </span><a href='https://allensdk.readthedocs.io/en/latest/'><span>Allen SDK</span></a><span> via </span><a href='https://github.com/JuliaPy/PyCall.jl'><span>PyCall.jl</span></a><span>. This means that we may load all information stored in the Allen Brain Atlas regarding cell 488697163 of the mouse cortex this way:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">manifest_path</span> <span class="cm-operator">=</span> <span class="cm-string">raw"path\to\manifest.json"</span> <span class="cm-comment"># path to previously-created allensdk manifest, or to the location where we want to save the manifest at.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">cell_dataset</span> &nbsp;<span class="cm-operator">=</span> <span class="cm-builtin">get_cell_dataset</span>(<span class="cm-variable">manifest_path</span>,<span class="cm-number">488697163</span>) </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 130px;"></div><div class="CodeMirror-gutters" style="display: none; height: 130px;"></div></div></div></pre><p><span>See </span><a href='#Dataset loading developments'><span>Dataset loading developments</span></a><span> for future improvements of this section.</span></p><p><span>The </span><code>cell_dataset</code><span> variable is an </span><code>OrderedDict</code><span> containing:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">julia</span><span class="cm-operator">&gt;</span> <span class="cm-variable">cell_dataset</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">Dict</span>{<span class="cm-variable">String</span>, <span class="cm-variable">Any</span>} <span class="cm-variable">with</span> <span class="cm-number">3</span> <span class="cm-variable">entries</span><span class="cm-operator">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"sweeps"</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">DefaultDict</span>{<span class="cm-variable">String</span>, <span class="cm-variable">DefaultOrderedDict</span>{<span class="cm-variable">String</span>, <span class="cm-variable">Vector</span>{<span class="cm-variable">Sweep</span>}, <span class="cm-variable">F</span>} <span class="cm-variable">where</span> <span class="cm-variable">F</span>, <span class="cm-variable">Vector</span>{<span class="cm-variable">Sweep</span>}}(<span class="cm-string">"ramp"</span><span class="cm-operator">=&gt;</span><span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"800.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.25</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span>, <span class="cm-operator">-</span><span class="cm-number">94.1875</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span> &nbsp;<span class="cm-variable">…</span> <span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"cell_ephys_features"</span> &nbsp;<span class="cm-operator">=&gt;</span> <span class="cm-variable">DataFrameRow…</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"cell_sweeps_features"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">Dict{Any, Any}</span>()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 182px;"></div><div class="CodeMirror-gutters" style="display: none; height: 182px;"></div></div></div></pre><p><span>For this brief overview, we are interested in the </span><code>sweeps</code><span> key, which points to a </span><code>DefaultDict</code><span> that groups the sweeps by input type:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">julia</span><span class="cm-operator">&gt;</span> <span class="cm-variable">cell_dataset</span>[<span class="cm-string">"sweeps"</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultDict</span>{<span class="cm-variable">String</span>, <span class="cm-variable">DefaultOrderedDict</span>{<span class="cm-variable">String</span>, <span class="cm-variable">Vector</span>{<span class="cm-variable">Sweep</span>}, <span class="cm-variable">F</span>} <span class="cm-variable">where</span> <span class="cm-variable">F</span>, <span class="cm-variable">Vector</span>{<span class="cm-variable">Sweep</span>}} <span class="cm-variable">with</span> <span class="cm-number">8</span> <span class="cm-variable">entries</span><span class="cm-operator">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"ramp"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"800.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.25</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span>, <span class="cm-operator">-</span><span class="cm-number">94.1875</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.2813</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>, <span class="cm-operator">-</span><span class="cm-number">14.0</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.</span><span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"square - 2s suprathreshold"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"110.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>], [<span class="cm-number">0.0</span><span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"test"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"0.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.125</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.1562</span>, <span class="cm-operator">-</span><span class="cm-number">13.1562</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">13.2187</span>, <span class="cm-operator">-</span><span class="cm-number">13.2812</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.125</span>, <span class="cm-operator">-</span><span class="cm-number">13.1875</span>, <span class="cm-operator">-</span><span class="cm-number">13.2187</span>, <span class="cm-operator">-</span><span class="cm-number">13.2187</span>, <span class="cm-operator">-</span><span class="cm-number">13.2187</span>, <span class="cm-operator">-</span><span class="cm-number">13.1562</span>, <span class="cm-operator">-</span><span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"long square"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"-110.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">93.8438</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span>, <span class="cm-operator">-</span><span class="cm-number">93.7813</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span>, <span class="cm-operator">-</span><span class="cm-number">93.8438</span>, <span class="cm-operator">-</span><span class="cm-number">93.7813</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.1875</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.0938</span>, <span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"square - 0.5ms subthreshold"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"-200.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span>, <span class="cm-operator">-</span><span class="cm-number">93.8438</span>, <span class="cm-operator">-</span><span class="cm-number">93.7813</span>, <span class="cm-operator">-</span><span class="cm-number">93.8438</span>, <span class="cm-operator">-</span><span class="cm-number">93.8125</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.8438</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.0625</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0625</span>, <span class="cm-operator">-</span><span class="cm-number">94.0625</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0625</span>, <span class="cm-operator">-</span><span class="cm-number">94.0938</span>, <span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"noise 2"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"259.375 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">94.9375</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">93.6875</span>, <span class="cm-operator">-</span><span class="cm-number">93.7188</span>, <span class="cm-operator">-</span><span class="cm-number">93.7813</span>, <span class="cm-operator">-</span><span class="cm-number">93.7188</span>, <span class="cm-operator">-</span><span class="cm-number">93.7813</span>, <span class="cm-operator">-</span><span class="cm-number">93.7188</span>, <span class="cm-operator">-</span><span class="cm-number">93.7188</span>, <span class="cm-operator">-</span><span class="cm-number">93.7813</span>, <span class="cm-operator">-</span><span class="cm-number">93.6875</span>, <span class="cm-operator">-</span><span class="cm-number">93.75</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0</span><span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"short square"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"400.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0625</span>, <span class="cm-operator">-</span><span class="cm-number">94.0</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.0625</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">93.9063</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.9063</span>, <span class="cm-operator">-</span><span class="cm-number">93.9688</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.9063</span>, <span class="cm-operator">-</span><span class="cm-number">93.9063</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">93.875</span>, <span class="cm-operator">-</span><span class="cm-number">93.90</span><span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"noise 1"</span> <span class="cm-operator">=&gt;</span> <span class="cm-builtin">DefaultOrderedDict</span>(<span class="cm-string">"255.0 pA"</span><span class="cm-operator">=&gt;</span>[<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span>, <span class="cm-operator">-</span><span class="cm-number">95.1563</span>, <span class="cm-operator">-</span><span class="cm-number">95.125</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">95.875</span>, <span class="cm-operator">-</span><span class="cm-number">95.8125</span>, <span class="cm-operator">-</span><span class="cm-number">95.8438</span>, <span class="cm-operator">-</span><span class="cm-number">95.8438</span>, <span class="cm-operator">-</span><span class="cm-number">95.8438</span>, <span class="cm-operator">-</span><span class="cm-number">95.8438</span>, <span class="cm-operator">-</span><span class="cm-number">95.8438</span>, <span class="cm-operator">-</span><span class="cm-number">95.8125</span>, <span class="cm-operator">-</span><span class="cm-number">95.8438</span>, <span class="cm-operator">-</span><span class="cm-number">95</span><span class="cm-variable">…</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 676px;"></div><div class="CodeMirror-gutters" style="display: none; height: 676px;"></div></div></div></pre><p><span>And then by input amplitude:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cell_dataset</span>[<span class="cm-string">"sweeps"</span>][<span class="cm-string">"square - 2s suprathreshold"</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">DefaultOrderedDict</span>{<span class="cm-variable">String</span>, <span class="cm-variable">Vector</span>{<span class="cm-variable">Sweep</span>}, <span class="cm-variable">DataType</span>} <span class="cm-variable">with</span> <span class="cm-number">3</span> <span class="cm-variable">entries</span><span class="cm-operator">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"110.0 pA"</span> <span class="cm-operator">=&gt;</span> [<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.75</span>, <span class="cm-operator">-</span><span class="cm-number">94.7188</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"150.0 pA"</span> <span class="cm-operator">=&gt;</span> [<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.3438</span>, <span class="cm-operator">-</span><span class="cm-number">94.375</span>, <span class="cm-operator">-</span><span class="cm-number">94.375</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span>, <span class="cm-operator">-</span><span class="cm-number">94.3125</span>, <span class="cm-operator">-</span><span class="cm-number">94.3438</span>, <span class="cm-operator">-</span><span class="cm-number">94.3438</span>, <span class="cm-operator">-</span><span class="cm-number">94.3438</span>, <span class="cm-operator">-</span><span class="cm-number">94.375</span>, <span class="cm-operator">-</span><span class="cm-number">94.4063</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.0</span>, <span class="cm-operator">-</span><span class="cm-number">94.0313</span>, <span class="cm-operator">-</span><span class="cm-number">93.9375</span>, <span class="cm-operator">-</span><span class="cm-number">94.0</span>, <span class="cm-operator">-</span><span class="cm-number">93.9375</span>, <span class="cm-operator">-</span><span class="cm-number">93.9688</span>, <span class="cm-operator">-</span><span class="cm-number">93.9375</span>, <span class="cm-operator">-</span><span class="cm-number">94.0</span>, <span class="cm-operator">-</span><span class="cm-number">93.9688</span>, <span class="cm-operator">-</span><span class="cm-number">93.9375</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.</span><span class="cm-variable">…</span> &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"190.0 pA"</span> <span class="cm-operator">=&gt;</span> [<span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">95.0313</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">94.9375</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span>, <span class="cm-operator">-</span><span class="cm-number">95.0</span>, <span class="cm-operator">-</span><span class="cm-number">94.9688</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.8438</span>, <span class="cm-operator">-</span><span class="cm-number">94.8125</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.9063</span>, <span class="cm-operator">-</span><span class="cm-number">94.7813</span>, <span class="cm-operator">-</span><span class="cm-number">94.8438</span>, <span class="cm-operator">-</span><span class="cm-number">94.8125</span>, <span class="cm-operator">-</span><span class="cm-number">94.8125</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span><span class="cm-variable">…</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 286px;"></div><div class="CodeMirror-gutters" style="display: none; height: 286px;"></div></div></div></pre><p><span>Once one has selected the type and the amplitude, all the recorded experimental sweeps corresponding to that stimulus configuration are presented:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">julia</span><span class="cm-operator">&gt;</span> <span class="cm-variable">cell_dataset</span>[<span class="cm-string">"sweeps"</span>][<span class="cm-string">"square - 2s suprathreshold"</span>][<span class="cm-string">"110.0 pA"</span>]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">4</span><span class="cm-operator">-</span><span class="cm-variable">element</span> <span class="cm-variable">Vector</span>{<span class="cm-variable">Sweep</span>}<span class="cm-operator">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875005364418</span>, <span class="cm-operator">-</span><span class="cm-number">94.7187557220459</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.7187557220459</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875005364418</span>, <span class="cm-operator">-</span><span class="cm-number">94.7187557220459</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.7812511920929</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.6875005364418</span>, <span class="cm-operator">-</span><span class="cm-number">94.7187557220459</span>, <span class="cm-operator">-</span><span class="cm-number">94.7812511920929</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.7500034570694</span>, <span class="cm-operator">-</span><span class="cm-number">94.7187557220459</span>, <span class="cm-operator">-</span><span class="cm-number">94.7812511920929</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>], [<span class="cm-number">0.005</span>, <span class="cm-number">0.01</span>, <span class="cm-number">0.015</span>, <span class="cm-number">0.02</span>, <span class="cm-number">0.025</span>, <span class="cm-number">0.03</span>, <span class="cm-number">0.034999999999999996</span>, <span class="cm-number">0.04</span>, <span class="cm-number">0.045000000000000005</span>, <span class="cm-number">0.05</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-number">10019.96</span>, <span class="cm-number">10019.964999999998</span>, <span class="cm-number">10019.970000000001</span>, <span class="cm-number">10019.975</span>, <span class="cm-number">10019.98</span>, <span class="cm-number">10019.985</span>, <span class="cm-number">10019.99</span>, <span class="cm-number">10019.994999999999</span>, <span class="cm-number">10020.0</span>, <span class="cm-number">10020.005</span>], (<span class="cm-number">150000</span>, <span class="cm-number">2004000</span>), (<span class="cm-variable">v</span> <span class="cm-operator">=</span> <span class="cm-number">0.001</span>, <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">1.0e-6</span>, <span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-number">0.001</span>), (<span class="cm-variable">sweep_number</span> <span class="cm-operator">=</span> <span class="cm-number">61</span>, <span class="cm-variable">sampling_rate_Hz</span> <span class="cm-operator">=</span> <span class="cm-number">200000.0</span>, <span class="cm-variable">number_of_spikes</span> <span class="cm-operator">=</span> <span class="cm-number">12</span>, <span class="cm-variable">metadata</span> <span class="cm-operator">=</span> <span class="cm-builtin">Dict{Any, Any}</span>(<span class="cm-string">"num_spikes"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">12</span>, <span class="cm-string">"stimulus_relative_amplitude"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">1.10000002384186</span>, <span class="cm-string">"stimulus_name"</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">"Square - 2s Suprathreshold"</span>, <span class="cm-string">"pre_vm_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">80.482666015625</span>, <span class="cm-string">"bridge_balance_mohm"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">23.0769233703613</span>, <span class="cm-string">"slow_vm_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">80.482666015625</span>, <span class="cm-string">"post_vm_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">80.8379364013672</span>, <span class="cm-string">"id"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">488697462</span>, <span class="cm-string">"stimulus_units"</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">"Amps"</span>, <span class="cm-string">"pre_noise_rms_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.0377454534173012</span><span class="cm-variable">…</span>)))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-builtin">Sweep{Float64}</span>([<span class="cm-operator">-</span><span class="cm-number">95.18750154972076</span>, <span class="cm-operator">-</span><span class="cm-number">95.15625381469727</span>, <span class="cm-operator">-</span><span class="cm-number">95.15625381469727</span>, <span class="cm-operator">-</span><span class="cm-number">95.12500607967377</span>, <span class="cm-operator">-</span><span class="cm-number">95.15625381469727</span>, <span class="cm-operator">-</span><span class="cm-number">95.15625381469727</span>, <span class="cm-operator">-</span><span class="cm-number">95.18750154972076</span>, <span class="cm-operator">-</span><span class="cm-number">95.28125220537186</span>, <span class="cm-operator">-</span><span class="cm-number">95.18750154972076</span>, <span class="cm-operator">-</span><span class="cm-number">95.18750154972076</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-operator">-</span><span class="cm-number">94.50000667572021</span>, <span class="cm-operator">-</span><span class="cm-number">94.50000667572021</span>, <span class="cm-operator">-</span><span class="cm-number">94.46875149011612</span>, <span class="cm-operator">-</span><span class="cm-number">94.43750375509262</span>, <span class="cm-operator">-</span><span class="cm-number">94.43750375509262</span>, <span class="cm-operator">-</span><span class="cm-number">94.43750375509262</span>, <span class="cm-operator">-</span><span class="cm-number">94.53125441074371</span>, <span class="cm-operator">-</span><span class="cm-number">94.46875149011612</span>, <span class="cm-operator">-</span><span class="cm-number">94.50000667572021</span>, <span class="cm-operator">-</span><span class="cm-number">94.43750375509262</span>], [<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>, <span class="cm-number">0.0</span>], [<span class="cm-number">0.005</span>, <span class="cm-number">0.01</span>, <span class="cm-number">0.015</span>, <span class="cm-number">0.02</span>, <span class="cm-number">0.025</span>, <span class="cm-number">0.03</span>, <span class="cm-number">0.034999999999999996</span>, <span class="cm-number">0.04</span>, <span class="cm-number">0.045000000000000005</span>, <span class="cm-number">0.05</span> &nbsp;<span class="cm-variable">…</span> &nbsp;<span class="cm-number">10019.96</span>, <span class="cm-number">10019.964999999998</span>, <span class="cm-number">10019.970000000001</span>, <span class="cm-number">10019.975</span>, <span class="cm-number">10019.98</span>, <span class="cm-number">10019.985</span>, <span class="cm-number">10019.99</span>, <span class="cm-number">10019.994999999999</span>, <span class="cm-number">10020.0</span>, <span class="cm-number">10020.005</span>], (<span class="cm-number">150000</span>, <span class="cm-number">2004000</span>), (<span class="cm-variable">v</span> <span class="cm-operator">=</span> <span class="cm-number">0.001</span>, <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">1.0e-6</span>, <span class="cm-variable">t</span> <span class="cm-operator">=</span> <span class="cm-number">0.001</span>), (<span class="cm-variable">sweep_number</span> <span class="cm-operator">=</span> <span class="cm-number">62</span>, <span class="cm-variable">sampling_rate_Hz</span> <span class="cm-operator">=</span> <span class="cm-number">200000.0</span>, <span class="cm-variable">number_of_spikes</span> <span class="cm-operator">=</span> <span class="cm-number">13</span>, <span class="cm-variable">metadata</span> <span class="cm-operator">=</span> <span class="cm-builtin">Dict{Any, Any}</span>(<span class="cm-string">"num_spikes"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">13</span>, <span class="cm-string">"stimulus_relative_amplitude"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">1.10000002384186</span>, <span class="cm-string">"stimulus_name"</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">"Square - 2s Suprathreshold"</span>, <span class="cm-string">"pre_vm_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">80.9035186767578</span>, <span class="cm-string">"bridge_balance_mohm"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">23.0769233703613</span>, <span class="cm-string">"slow_vm_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">80.9035186767578</span>, <span class="cm-string">"post_vm_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">-</span><span class="cm-number">80.4853668212891</span>, <span class="cm-string">"id"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">488697464</span>, <span class="cm-string">"stimulus_units"</span> <span class="cm-operator">=&gt;</span> <span class="cm-string">"Amps"</span>, <span class="cm-string">"pre_noise_rms_mv"</span> <span class="cm-operator">=&gt;</span> <span class="cm-number">0.0276526212692261</span><span class="cm-variable">…</span>))</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">...</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 754px;"></div><div class="CodeMirror-gutters" style="display: none; height: 754px;"></div></div></div></pre><p><span>Each </span><code>Sweep</code><span> is a struct representing a sweep. It has the following definition:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># _Sweep.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">struct</span> <span class="cm-variable">Sweep</span>{<span class="cm-variable">T</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">v</span><span class="cm-builtin">::Vector{T}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i</span><span class="cm-builtin">::Vector{Float64}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">t</span><span class="cm-builtin">::Vector{Float64}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">index_range</span><span class="cm-builtin">::Tuple{Int64,Int64}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">UOM</span><span class="cm-builtin">::NamedTuple{(:v, :i, :t), Tuple{Float64, Float64, Float64}}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">extra_data</span><span class="cm-builtin">::NamedTuple{&lt;:Any, &lt;:Tuple{Vararg{Any}}}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 260px;"></div><div class="CodeMirror-gutters" style="display: none; height: 260px;"></div></div></div></pre><p><span>Where:</span></p><ul><li><code>v</code><span>: the membrane potential time series ;</span></li><li><code>i</code><span>: the stimulus time series ;</span></li><li><code>t</code><span>: the time steps at which </span><code>v</code><span> and </span><code>i</code><span> are simultaneously recorded. Equal time stepping </span><a href='https://github.com/AllenInstitute/AllenSDK/issues/2210'><span>is required for Allen SDK to work properly</span></a><span> ;</span></li><li><code>index_range</code><span>: index range (subset of </span><code>1:length(t)</code><span>) that includes the stimulus but excludes test pulses. See </span><a href='http://help.brain-map.org/display/celltypes/Documentation'><span>Allen Elecrophysiology Overview Whitepaper</span></a><span> ;</span></li><li><code>UOM</code><span>: units of measure with respect to SI of the three time series </span><code>v</code><span>,</span><code>i</code><span> and </span><code>t</code><span>. So if their units are , respectively, mV, pA and sec, </span><code>UOM</code><span> will be </span><code>(v = 1e-3, i = 1e-12, t = 1e0)</code><span>. This field is required so that the modeler may use the units she/he prefers (this may influence solver&#39;s performance), while the pipeline is constantly aware of current units and may convert them when needed ;</span></li><li><code>extra_data</code><span>: extra information about the sweep or the cell it comes from.</span></li></ul><p><span>Now that we have the model and the dataset, we only need one more ingredient, </span><code>Feature</code><span>s, and then we&#39;ll be ready for calibration setup.</span></p><h3 id='24-features'><span>2.4 Features</span></h3><p><span>As stated in the </span><strong><span>feature-based parameter estimation</span></strong><span> bullet point, it makes little sense to use the raw membrane potential time series as reference data to calibrate against. A more optimal solution would be the identification of a set of features of these time series that is both minimalistic and fully encodes electrophysiological dynamics. Our framework supports the use of features via the </span><code>Feature</code><span> struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># _Feature.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">Feature</span>{<span class="cm-variable">E</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span>,<span class="cm-variable">L</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span>,<span class="cm-variable">M</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span>,<span class="cm-variable">S</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Union</span>{<span class="cm-variable">Function</span>,<span class="cm-variable">Nothing</span>}, <span class="cm-variable">G</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span>}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-builtin">::String</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">default_standard_deviation</span><span class="cm-builtin">::Union{Float64,Nothing}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">UOM</span><span class="cm-builtin">::Float64</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">evaluation</span><span class="cm-builtin">::E</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">loss</span><span class="cm-builtin">::L</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">mean_function</span><span class="cm-builtin">::M</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">std_function</span><span class="cm-builtin">::S</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">kwargs</span><span class="cm-builtin">::NamedTuple{&lt;:Any, &lt;:Tuple{Vararg{Any}}}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">loss_kwargs_evaluation</span><span class="cm-builtin">::G</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><p><span>Some relevant fields:</span></p><ul><li><code>evaluation</code><span>: the actual &quot;formula&quot; that intuitively takes a sweep an input and evaluated the corresponding feature ;</span></li><li><code>loss</code><span>: the loss function associated to this feature, i.e. a function that takes two values of this </span><code>Feature</code><span> (one coming from the experimental trace, and the other from the set of parameters that is currently evaluated during calibation), and returns a </span><code>Float64</code><span>; </span></li><li><span>other fields: necessary fields to allow for the most general features to be implemented .</span></li></ul><p><span>Now that we have features, we may move on to setup the calibration.</span></p><h3 id='25-calibration-setup'><span>2.5 Calibration setup</span></h3><p><span>The idea behind the following setup is the utilization of a framework that can be generalized to as many other fields than neuroscience as possible. The information needed to setup the calibration is a set of associations between experimental data and features that we want to calibrate our model against simultaneously.</span></p><p><span>In our case, the &quot;unit of data&quot; is a group of sweeps coming from the same cell when injected with a particular stimulus (defined by its type and amplitude), that we encoded in a </span><code>Type_Amplitude</code><span> struct:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># _Sweep.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">## a struct representing a type_amplitude</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">struct</span> <span class="cm-variable">Type_Amplitude</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">AbstractMeasurement</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">type</span><span class="cm-builtin">::String</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">amplitude</span><span class="cm-builtin">::String</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">sweeps</span><span class="cm-builtin">::Tuple{Vararg{Sweep}}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">end</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 208px;"></div><div class="CodeMirror-gutters" style="display: none; height: 208px;"></div></div></div></pre><p><span>We may get some </span><code>Type_Amplitude</code><span> instances by using an utility function on the </span><code>cell_dataset</code><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">square_110pA</span> <span class="cm-operator">=</span> <span class="cm-builtin">get_type_amplitude</span>(<span class="cm-variable">cell_dataset</span>, <span class="cm-string">"square - 2s suprathreshold"</span>, <span class="cm-string">"110.0 pA"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">ramp_800pA</span> &nbsp; <span class="cm-operator">=</span> <span class="cm-builtin">get_type_amplitude</span>(<span class="cm-variable">cell_dataset</span>, <span class="cm-string">"ramp"</span>, <span class="cm-string">"800.0 pA"</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="display: none; height: 104px;"></div></div></div></pre><p><span>Also, the pipeline exports some standard electrophysiological features that we group as suggested in </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002133'><span>Druckmann2011</span></a><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">square_features</span> <span class="cm-operator">=</span>  (<span class="cm-variable">allen_firing_frequency_Hz</span>, <span class="cm-variable">allen_latency_to_first_spike_msec</span>, <span class="cm-variable">allen_isi_cv</span>, <span class="cm-variable">allen_spike_width_at_hh_msec</span>, &nbsp; <span class="cm-variable">allen_action_potential_peak_mV</span>, <span class="cm-variable">allen_fast_trough_depth_mV</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">ramp_features</span> <span class="cm-operator">=</span>  (<span class="cm-variable">allen_firing_frequency_Hz</span>, <span class="cm-variable">allen_latency_to_first_spike_msec</span>, <span class="cm-variable">allen_isi_cv</span>, <span class="cm-variable">allen_spike_width_at_hh</span>, &nbsp; <span class="cm-variable">allen_action_potential_peak_mV</span>, <span class="cm-variable">allen_fast_trough_depth_mV</span>, <span class="cm-variable">spike_height_slope</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 156px;"></div><div class="CodeMirror-gutters" style="display: none; height: 156px;"></div></div></div></pre><p><span>Here I just used 7, but there are about 24 features implemented out of the box, coming from the various </span><a href=''><span>Allen technical whitepapers</span></a><span> and the cited relevant literature, that could be roughly divided in two groups: Druckmann-like (features compatible with a loss that takes experimental standard deviations into account), and L2-like (features that are best suited with a L2 loss, like </span><a href='https://www.researchgate.net/publication/329683440_Introduction_to_equation_solving_and_parameter_fitting'><span>LeMasson and Maex, 2001</span></a><span>. and Maex&#39;s phase plane trajectory density). Some features that do not fall into these paradigms, like </span><a href='https://ieeexplore.ieee.org/document/8682825'><span>Xu2019</span></a><span>&#39;s coincidence factor, can anyway be integrated with the framework.</span></p><p><span>Now we want to set up associations, to tell the pipeline which features we would like to calibrate w.r.t. which data, here we choose to calibrate both </span><code>Type_Amplitude</code><span>s w.r.t. the same features set, so we write:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">square_110_association</span> <span class="cm-operator">=</span> <span class="cm-builtin">Association</span>(<span class="cm-string">"square_110_association"</span>,<span class="cm-variable">square_110pA</span>,<span class="cm-variable">square_features</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">ramp_800_association</span> <span class="cm-operator">=</span> <span class="cm-builtin">Association</span>(<span class="cm-string">"ramp_800_association"</span>,<span class="cm-variable">ramp_800pA</span>,<span class="cm-variable">ramp_features</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 104px;"></div><div class="CodeMirror-gutters" style="display: none; height: 104px;"></div></div></div></pre><p><span>To understand the remainder, we need a brief excursus on multi-phase calibration. It is a calibration technique that is useful when:</span></p><ul><li><span>there are external forces driving the physical system dynamics that are not included in the model ;</span></li><li><span>these external forces only apply at discrete times, the number of which and/or their location in time being known in advance.</span></li></ul><p><span>Say that we are in the case where we know when those unaccounted external forces happen. The time intervals between each external intervention will be called </span><code>Phase</code><span>, and within each </span><code>Phase</code><span> the modeler could be interested in developing a calibration strategy composed of different passages, each of which will be represented by a </span><code>Step</code><span> struct.</span></p><p><span>When it comes to neuronal models, multi-phase calibration is not needed (we just need one </span><code>Phase</code><span>, since we calibrate w.r.t. to the entire train set at once), but one may be interested in using different algorithms and setups in a particular order, or better, one may need </span><code>Step</code><span>s:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># ModelingFramework.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">mutable</span> <span class="cm-variable">struct</span> <span class="cm-variable">Step</span>{<span class="cm-variable">F</span> <span class="cm-operator">&lt;:</span> <span class="cm-variable">Union</span>{<span class="cm-variable">Nothing</span>, <span class="cm-operator">&lt;:</span> <span class="cm-variable">Function</span>} } <span class="cm-operator">&lt;:</span> <span class="cm-variable">AbstractStep</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">name</span><span class="cm-builtin">::String</span> &nbsp; &nbsp; &nbsp; <span class="cm-comment"># The name of the step. Used for later storage in `caibration_history`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">method</span><span class="cm-builtin">::F</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># It must have signature (data::D, Model::M; kwargs...) where {D &lt;: Tuple{Vararg{&lt;:AbstractData}}, M&lt;: AbstractModel}</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">kwargs</span><span class="cm-builtin">::NamedTuple</span> <span class="cm-comment"># kwargs to be passed to `method`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">en</span><span class="cm-string">`</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="display: none; height: 234px;"></div></div></div></pre><p><span>Thus, we may instantiate a Step as follows:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># main.jl</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-variable">save_idxs</span> <span class="cm-operator">=</span> [<span class="cm-number">1</span>] <span class="cm-comment"># corresponds to voltage trace</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">bbo_borgmoea_step</span> <span class="cm-operator">=</span> <span class="cm-builtin">Step</span>(<span class="cm-string">"bbo_borgmoea_step"</span>,<span class="cm-variable">bbo_borgmoea_method</span>, (<span class="cm-variable">variable_parameters_symbols</span> <span class="cm-operator">=</span> <span class="cm-variable">parameters_symbols_HH__Na_Kd_M_L_BTF</span>, <span class="cm-variable">save_idxs</span> <span class="cm-operator">=</span> <span class="cm-variable">save_idxs</span>, <span class="cm-variable">modelingtoolkit</span> <span class="cm-operator">=</span> <span class="cm-builtin">true</span>, <span class="cm-variable">cell_dataset_optimization</span> <span class="cm-operator">=</span> <span class="cm-builtin">Cell_Dataset_Optimization</span>( <span class="cm-builtin">true</span>,<span class="cm-string">"block_average"</span>, &nbsp;<span class="cm-variable">excluded_features</span> <span class="cm-operator">=</span> (<span class="cm-string">"custom_voltage_base_mV_druck"</span>,<span class="cm-string">"custom_voltage_base_mV_l2"</span>,<span class="cm-string">"custom_steady_state_voltage_stimend_mV_druck"</span>, <span class="cm-string">"custom_steady_state_voltage_stimend_mV_l2"</span>, <span class="cm-string">"custom_voltage_after_stim_mV_druck"</span>, <span class="cm-string">"custom_voltage_after_stim_mV_l2"</span>, <span class="cm-string">"spike_times_msec"</span>)), <span class="cm-variable">maxtime</span> <span class="cm-operator">=</span> <span class="cm-number">30</span><span class="cm-operator">*</span><span class="cm-number">60</span> ) )</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 234px;"></div><div class="CodeMirror-gutters" style="display: none; height: 234px;"></div></div></div></pre><p><span>The </span><code>bbo_borgmoea_method</code><span> is a method exported by the </span><code>ComputationalNeuroscience</code><span> that implements calibration using the </span><code>:borg_moea</code><span> algorithm from </span><a href='https://github.com/robertfeldt/BlackBoxOptim.jl'><span>BlackBoxOptim.jl</span></a><span>. There are analogous methods tha tgive access to the algorithms from </span><a href='https://github.com/JuliaNLSolvers/Optim.jl'><span>Optim.jl</span></a><span>, </span><a href='https://github.com/TuringLang/Turing.jl'><span>Turing.jl</span></a><span>, </span><a href='https://github.com/wildart/Evolutionary.jl'><span>Evolutionary.jl</span></a><span> and </span><a href='https://github.com/jmejia8/Metaheuristics.jl'><span>Metaheuristics.jl</span></a><span>. All the arguments that follow are given as </span><code>kwargs</code><span> to </span><code>bbo_borgmoea_method</code><span>. The </span><code>parameters_symbols_HH__Na_Kd_M_L_BTF</code><span> argument allows for quickly including/excluding individual parameters from calibration (here we choose to calibrate all of them).   The </span><code>modelingtoolkit</code><span> argument tells the pipeline to </span><code>modelingtoolkitize</code><span> the model, for incresed performance. To allow for it, stimuli are internally represented as functions (right now only square and ramp stimuli support this feature, we plan to add others in the future). The </span><code>Cell_Dataset_Optimization(true, &quot;block_average&quot;)</code><span> specifies that we wish to apply an heuristic to trim the sweeps so that only the relevant portion and some equal margin is considered, while the </span><code>&quot;block_average&quot;</code><span> argument specifies the technique to remove points in the sweep in order to determine lower bound on solver stepping and perform other secondary optimization. The optimization procedure is automatically stopped when it detects that a feature of the optimized dataset differs from the same feature of the unoptimized one more than an experimental standard deviation.</span></p><p><span>We will perform a single-step calibration.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">single_step_calibration!</span>((<span class="cm-variable">square_110_association</span>, <span class="cm-variable">ramp_800_association</span>), <span class="cm-variable">HH__Na_Kd_M_L_BTF</span>, <span class="cm-variable">bbo_borgmoea_step</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 52px;"></div><div class="CodeMirror-gutters" style="display: none; height: 52px;"></div></div></div></pre><p><span>At the end of the calibration, resulting parameters sets (together with optimized initial conditions and posterior if required by custom calibration techniques), may be found in the </span><code>calibration_history</code><span> field of the model:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">julia</span><span class="cm-operator">&gt;</span> <span class="cm-builtin">get_calibratables_values</span>(<span class="cm-builtin">get_last_configuration</span>(<span class="cm-variable">HH__Na_Kd_M_L_BTF</span><span class="cm-operator">.</span><span class="cm-variable">calibration_history</span>)<span class="cm-operator">.</span><span class="cm-variable">parameters</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-number">46</span><span class="cm-operator">-</span><span class="cm-variable">element</span> <span class="cm-variable">Vector</span>{<span class="cm-variable">Float64</span>}<span class="cm-operator">:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">8.329481760571682</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">70.5016621571624</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">62.09685457172623</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">9.858797725026903</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-number">0.009504285040026086</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-operator">-</span><span class="cm-number">80.1864762458009</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">⋮</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-operator">-</span><span class="cm-number">64.14007514627994</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-operator">-</span><span class="cm-number">80.64025855432278</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">15.919456056391812</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-number">164.9340181305733</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-operator">-</span><span class="cm-number">25.45128186775263</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;<span class="cm-number">80.67340483048163</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 390px;"></div><div class="CodeMirror-gutters" style="display: none; height: 390px;"></div></div></div></pre><p>&nbsp;</p><h2 id='3-possible-applications-from-literature'><span>3. Possible Applications from Literature</span></h2><p><span>Although this work is far from over, we believe there is some value in it, the interested reader may confirm that applications such as  </span><a href='https://www.sciencedirect.com/science/article/abs/pii/S0925231211006618?via%3Dihub'><span>Buhry2012</span></a><span> easily fit in our framework, since the necessary algorithms are already integrated, and the possibility of defining custom </span><code>Feature</code><span>s  is already there. On the other hand, the integration of techniques like the one found in </span><a href='https://link.springer.com/article/10.1007%2Fs00422-011-0459-1'><span>Thot2011</span></a><span>, may still require some effort. Other techniques, like the one based on the </span><em><span>coincidence factor</span></em><span> in </span><a href='https://ieeexplore.ieee.org/document/8682825'><span>Xu2019</span></a><span> and the </span><em><span>phase plane trajectory density</span></em><span> in </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.0020094'><span>Achard2006</span></a><span> and </span><a href='https://www.researchgate.net/publication/329683440_Introduction_to_equation_solving_and_parameter_fitting'><span>LeMasson and Maex, 2001</span></a><span>, have already been integrated.</span></p><h2 id='4-near-future-developments'><span>4. Near Future Developments</span></h2><h3 id='recipe'><span>Recipe</span></h3><p><span>We aim to give a quick working recipe to effectively calibrate many HH-type (maybe even compartmental) models.</span></p><h3 id='hh-type-model-definition'><span>HH-type model definition</span></h3><p><span>We will implement a system that allows the user to define an HH model as follows:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="julia"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang="julia"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 11px; left: 4px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">HH_Na_Kd_L</span> <span class="cm-operator">=</span> <span class="cm-builtin">HH_model</span>(<span class="cm-variable">I_Na</span>, <span class="cm-variable">I_Kd</span>, <span class="cm-variable">I_L</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 26px;"></div><div class="CodeMirror-gutters" style="display: none; height: 26px;"></div></div></div></pre><h2 id='5-long-term-developments--needed-contributions'><span>5. Long Term Developments / Needed Contributions</span></h2><p><span>Developing a model calibration framework requires a large and heterogeneous amount of expertise that we are currently missing. </span></p><p><span>Although we haven&#39;t given up yet, despite following the advices in </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002133'><span>Druckmann2011</span></a><span> the optimization algorithms always output a &quot;best parameters set&quot; that is indifferent to the applied stimulus (within a certain range). See </span><a href='#6-example-calibration-results'><span>section 6</span></a><span> for a better visualization of this issue. We probably ruled out the possibility that it is a bug, and it may be correlated to the following other areas where we lack expertise:</span></p><ul><li><strong><span>Optimization algorithm tuning</span></strong><span>. Here is a </span><a href=''><span>Twitter thread</span></a><span> with references and the question in more details when it comes to evolutionary algorithms. Also, </span><a href='https://github.com/TuringLang/Turing.jl'><span>Turing.jl</span></a><span> is fully supported and usable with the same interface above (just set </span><code>method = :turing_neuro</code><span>), and although it works well on another project we are developing on epidemiological models, it achieves very poor performance on HH-type models.  </span></li><li><strong><span>Modeling choices</span></strong><span>. It may be that the HH-type models we tried so far (the most complete of them being the one shown above) may be inappropriate, or we could be missing some relations between the cell we select the train sweeps from and the model itself. We don&#39;t know whether multi-compartmental models are unavoidable, as the literature seems to suggest, or if we could dramatically improve calibration performance by just more fine tuning of the single-compartment models we are currently using. Also, this framework may need modifications in orderer to be compatible with GLIFs and multi-compartmental models.</span></li><li><strong><span>Optimization techniques</span></strong><span>. We have not been able to implement every possible calibration technique. A particularly relevant and missing one are Kalman Filters. Some possible references on the subject may be </span><a href='https://www.sciencedirect.com/science/article/abs/pii/S0925231214001155?via%3Dihub'><span>Lankarany2014</span></a><span>, </span><a href='https://www.mdpi.com/2076-3417/10/2/550'><span>Campbell2019</span></a><span> (for the inverse problem), </span><a href='https://mathematical-neuroscience.springeropen.com/articles/10.1186/s13408-018-0066-8'><span>Moye2018</span></a><span> and </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000696'><span>Lillacci2010</span></a><span>, but there may be better ones. Any help would be greatly appreciated. Other techniques we did not implement are the ones presented in </span><a href='https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002401#pcbi.1002401-Kitagawa1'><span>Vavoulis2012</span></a><span> , </span><a href='https://www.sciencedirect.com/science/article/abs/pii/S092523120600347X'><span>Haufler2007</span></a><span> and </span><a href='https://link.springer.com/article/10.1007%2Fs00422-014-0615-5'><span>Meliza2014</span></a><span>.</span></li></ul><p><span>We would be very grateful if anybody could help with these issues. </span></p><h2 id='6-example-calibration-results'><span>6. Example Calibration Results</span></h2><p><span>Here is the output of an 8-hour run, where we calibrated the above </span><code>HH__Na_Kd_M_L</code><span> model w.r.t. the </span><code>square_110pA</code><span> sweeps set (which counted 4 sweeps), using the following features:</span></p><ul><li><strong><span>time_of_slow_trough_fraction</span></strong><span>: time from the spike peak to the slow through, divided by the </span><code>isi</code><span> length, adimensional ;</span></li><li><strong><span>AP_width_hh_msec</span></strong><span>:  width at half-height of the action potential, expressed in msec ;</span></li><li><strong><span>adaptation_index</span></strong><span>: adaptation index, adimensional ;</span></li><li><strong><span>firing_frequency_Hz</span></strong><span>: firing frequency, expressed in Hz ;</span></li><li><strong><span>isi_cv</span></strong><span>: interspike interval (durations) coefficient of variation, adimensional;</span></li><li><strong><span>latency_to_first_spike_msec</span></strong><span>: time from start of recording to first peak, expressed in msec ;</span></li><li><strong><span>duration_of_first_isi_msec</span></strong><span>: duration of first interspike interval, expressed in msec ;</span></li><li><strong><span>action_potential_peak_mV</span></strong><span>: action potentials&#39; peaks height, expressed in mV ;</span></li><li><strong><span>fast_trough_depth_mV</span></strong><span>: fast through depth, expressed in mV ;</span></li><li><strong><span>average_isi_msec</span></strong><span>: average interspike interval duration, expressed in msec ;</span></li><li><strong><span>resting_potential_mV</span></strong><span>: resting potential, expressed in mV ;</span></li><li><strong><span>slow_trough_depth_mV</span></strong><span>: slow through depth, expressed in mV .</span></li></ul><p><span>More details about these features are provided in the Allen technical whitepaper </span><a href='http://help.brain-map.org/display/celltypes/Documentation'><span>Electrophysiology Overview</span></a><span>.</span></p><p><span>The achieved performance, in units of experimental standard deviation (see </span><a href='https://www.frontiersin.org/articles/10.3389/neuro.01.1.1.001.2007/full'><span>Druckmann2007</span></a><span>) is:</span></p><ul><li><strong><span>time_of_slow_trough_fraction</span></strong><span>: 2.23066 ;</span></li><li><strong><span>AP_width_hh_msec</span></strong><span>:  5.36808 ;</span></li><li><strong><span>adaptation_index</span></strong><span>: 1.02698 ;</span></li><li><strong><span>firing_frequency_Hz</span></strong><span>: 1.96846 ;</span></li><li><strong><span>isi_cv</span></strong><span>: 1.32066 ;</span></li><li><strong><span>latency_to_first_spike_msec</span></strong><span>: 3.13225 ;</span></li><li><strong><span>duration_of_first_isi_msec</span></strong><span>: 0.12058 ;</span></li><li><strong><span>action_potential_peak_mV</span></strong><span>: 7.20770 ;</span></li><li><strong><span>fast_trough_depth_mV</span></strong><span>: 1.49870 ;</span></li><li><strong><span>average_isi_msec</span></strong><span>: 1.76509 ;</span></li><li><strong><span>resting_potential_mV</span></strong><span>: 9.74667 ;</span></li><li><strong><span>slow_trough_depth_mV</span></strong><span>: 3.67717 </span></li></ul><p><span>which amounts to an aggregated loss of 39.063, that while being not too far from the 3 standard deviations per features goal (</span><code>3*12 = 36</code><span>), it is not very much satisfying either. Infact, if one looks at a simulated trace (blue) plotted together with one of the sweeps used for calibration:</span></p><p><img src="https://github.com/InPhyT/inphyt.github.io/blob/master/ComputationalNeuroscience/images/calibration_results.PNG" referrerpolicy="no-referrer" alt="calibration_results.PNG"></p><p><span>She/he may notice that:</span></p><ul><li><span>Spike coincidence is not a visual feature to take into consideration when qualitatively judging the results of a calibration run, since there is great variance in spike times (see plot below) ;</span></li><li><span>The parameters set found does not take the injected current into consideration, as it keeps spiking well beyond the end of the current stimulus.</span></li></ul><p><span>To address the second issue, we tried the following strategies without success:</span></p><ul><li><span>incorporate a </span><code>latency_to_last_spike</code><span> feature ;</span></li><li><span>calibrate w.r.t. 4 </span><code>Type_Amplitude</code><span>s (recall that each  </span><code>Type_Amplitude</code><span> is a sweeps set corresponding to one stimulus waveform ), 3 of which did not produce any spike in the real neuron ;</span></li></ul><p><span>None of these secceded.</span></p><p><span>We wrap up by showing more plots relative to the above run:</span></p><p><strong><span>Model currents, gating variables dynamics (with zoom in on first spike)</span></strong><span>:</span></p><p><img src="https://github.com/InPhyT/inphyt.github.io/blob/master/ComputationalNeuroscience/images/time_series.PNG" referrerpolicy="no-referrer" alt="time_series.PNG"></p><p><strong><span>Same with voltage on the x-axis</span></strong><span>:</span></p><p><img src="https://github.com/InPhyT/inphyt.github.io/blob/master/ComputationalNeuroscience/images/phase_space.PNG" referrerpolicy="no-referrer" alt="phase_space.PNG"></p><p><strong><span>All the experimental sweeps used</span></strong><span>:</span></p><p><img src="https://github.com/InPhyT/inphyt.github.io/blob/master/ComputationalNeuroscience/images/type_amplitude.PNG" referrerpolicy="no-referrer" alt="type_amplitude.PNG"></p><p><span>In our opinion, this example shows both the possibilities of this framework, and the issues that still persist.</span></p><p><span>We hope to have even slightly caught your attention, don&#39;t hesitate to reach out if you think you may give some much needed help and suggestions!</span></p><p><a href='https://twitter.com/johnmyleswhite'><span>@johnmyleswhite</span></a><span>, </span><a href='https://twitter.com/KristofferC89'><span>@KristofferC89</span></a><span>, </span><a href='https://twitter.com/briochemc'><span>@briochemc</span></a><span>, </span><a href='https://twitter.com/benskuhn'><span>@benskuhn</span></a><span>, </span><a href='https://twitter.com/drfeldt'><span>@drfeldt</span></a><span>, </span><a href='https://twitter.com/ranjan_ananth'><span>@ranjan_ananth</span></a><span>, </span><a href='https://twitter.com/baggepinnen'><span>@baggepinnen</span></a><span>, </span><a href='https://twitter.com/ChrisRackauckas'><span>@ChrisRackauckas</span></a><span> </span><a href='https://twitter.com/vchuravy'><span>@vchuravy</span></a><span>, </span><a href='https://twitter.com/rogerluorl18'><span>@rogerluorl18</span></a><span>  </span><a href='https://twitter.com/TuringLang'><span>@TuringLang</span></a><span>, </span><a href='https://twitter.com/xukai92'><span>@xukai92</span></a><span>, </span><a href='https://twitter.com/Hong_Ge2'><span>@Hong_Ge2</span></a><span>, </span><a href='https://twitter.com/cameron_pfiffer'><span>@cameron_pfiffer</span></a><span>, </span><a href='https://twitter.com/martin_trapp'><span>@martin_trapp</span></a><span>, </span><a href='https://twitter.com/MathieuEmile'><span>@MathieuEmile</span></a><span>, </span><a href='https://twitter.com/torfjelde'><span>@torfjelde</span></a><span>, </span><a href='https://twitter.com/sethaxen'><span>@sethaxen</span></a><span>, </span><a href='https://twitter.com/ANoackJensen'><span>@ANoackJensen</span></a><span>, </span><a href='https://twitter.com/HarrisonDWilde'><span>@HarrisonDWilde</span></a></p><p><span>@AlexGuetMcC , @AmitChaudhariMD, @Anna</span><strong><span>K</span></strong><span>K , @bradleyvoytek   , @misicbata       , @ChristianPehle  , @DamienQuerlioz  , @cdmeliza   , @MelissaRWarden  , @DrValiante      , @gmiotto         , @Segev_Lab   , @neurodidact     , @julie_grollier  , @lauracrucianel1 , @ogrisel         , @TheBrunoCortex  , @wake_sleep  , @RichCompNeuro   , @sergeydoestweet , @ShaulDr     , @neuronJoy       , @srikipedia      , @SylvainSaighi</span></p><p><span>@bcm_neurosci   ,@ChenLabNeuro   ,@ChicagoSfN     ,@C_R_A_N_I_A    ,@EITN_Paris     ,@ELSCbrain      ,@EPFL_en        ,@BlueBrainPjt   ,@INCForg        ,@HBPBrainSim    ,@HBP_Education  ,@KCNHub         ,@NeuralCompLab  ,@NeurIPSConf    ,@NIN_knaw       ,@NeuroPSI_saclay,@RadioSpin_EU   ,@SurLabMIT      </span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p></div></div>
</body>
</html>